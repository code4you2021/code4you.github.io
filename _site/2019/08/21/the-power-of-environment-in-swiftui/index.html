<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>The power of Environment in SwiftUI | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="The power of Environment in SwiftUI" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Environment is one of the unique features of SwiftUI which we didn’t have before in UIKit. Today I would like to show you all the benefits of using Environment in your apps." />
<meta property="og:description" content="Environment is one of the unique features of SwiftUI which we didn’t have before in UIKit. Today I would like to show you all the benefits of using Environment in your apps." />
<link rel="canonical" href="http://localhost:4000/2019/08/21/the-power-of-environment-in-swiftui/" />
<meta property="og:url" content="http://localhost:4000/2019/08/21/the-power-of-environment-in-swiftui/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-08-21T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="The power of Environment in SwiftUI" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2019/08/21/the-power-of-environment-in-swiftui/"},"url":"http://localhost:4000/2019/08/21/the-power-of-environment-in-swiftui/","author":{"@type":"Person","name":"Code4You"},"headline":"The power of Environment in SwiftUI","description":"Environment is one of the unique features of SwiftUI which we didn’t have before in UIKit. Today I would like to show you all the benefits of using Environment in your apps.","dateModified":"2019-08-21T00:00:00+08:00","datePublished":"2019-08-21T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">The power of Environment in SwiftUI</h2>
  <time datetime="2019-08-21T00:00:00+08:00" class="post-date">21 Aug 2019</time>
  <p><em>Environment</em> is one of the unique features of SwiftUI which we didn’t have before in <em>UIKit</em>. Today I would like to show you all the benefits of using <em>Environment</em> in your apps.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<h4 id="environment">Environment</h4>
<p>Let’s start with describing the idea of <em>Environment</em>. We already discussed it previously in <a href="/2019/06/12/understanding-property-wrappers-in-swiftui/">“Understanding Property Wrappers in SwiftUI”</a>, but I want to start with basics. When you create and start your very first <em>View</em> in SwiftUI, the framework generates <em>Environment</em> for it. SwiftUI creates it automatically, and we don’t need to do something.</p>

<p>SwiftUI uses <em>Environment</em> to pass system-wide settings like <em>ContentSizeCategory, LayoutDirection, ColorScheme, etc</em>. <em>Environment</em> also contains app-specific stuff like <em>UndoManager</em> and <em>NSManagedObjectContext</em>. Full list of the passed values you can find in <a href="https://developer.apple.com/documentation/swiftui/environmentvalues"><em>EnvironmentValues</em> struct documentation</a>. Let’s take a look at an example where we access <em>Environment</em> values.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ButtonsView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@Environment</span><span class="p">(\</span><span class="o">.</span><span class="n">sizeCategory</span><span class="p">)</span> <span class="k">var</span> <span class="nv">sizeCategory</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">Group</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">sizeCategory</span> <span class="o">==</span> <span class="o">.</span><span class="n">accessibilityExtraExtraExtraLarge</span> <span class="p">{</span>
                <span class="kt">VStack</span> <span class="p">{</span>
                    <span class="n">buttons</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="kt">HStack</span> <span class="p">{</span>
                    <span class="n">buttons</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>By using @<em>Environment property wrapper</em>, we can read and subscribe on changes for the selected value. Here we have <em>ButtonsView</em> that reads Dynamic Type value from <em>Environment</em> and put buttons in <em>VStack</em> or <em>HStack</em> depending on the size category value. User can change Dynamic Type value in the system settings, and as soon as it happens, SwiftUI will recreate <em>ButtonsView</em> to respect the changes.</p>

<p>Now let’s see how we can modify <em>Environment</em> values. In SwiftUI we don’t have separation like <em>Controllers</em> or <em>Views</em>. Everything is a <em>View</em>, and because of that, we can easily modify <em>Environment</em> for an entire view hierarchy of the app by adding <em>environment modifier</em> to the root view.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">scene</span><span class="p">(</span><span class="n">_</span> <span class="nv">scene</span><span class="p">:</span> <span class="kt">UIScene</span><span class="p">,</span> <span class="n">willConnectTo</span> <span class="nv">session</span><span class="p">:</span> <span class="kt">UISceneSession</span><span class="p">,</span> <span class="n">options</span> <span class="nv">connectionOptions</span><span class="p">:</span> <span class="kt">UIScene</span><span class="o">.</span><span class="kt">ConnectionOptions</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">window</span> <span class="o">=</span> <span class="kt">UIWindow</span><span class="p">(</span><span class="nv">windowScene</span><span class="p">:</span> <span class="n">scene</span> <span class="k">as!</span> <span class="kt">UIWindowScene</span><span class="p">)</span>
        <span class="n">window</span><span class="p">?</span><span class="o">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="kt">UIHostingController</span><span class="p">(</span>
            <span class="nv">rootView</span><span class="p">:</span> <span class="kt">RootView</span><span class="p">()</span>
                <span class="o">.</span><span class="nf">environment</span><span class="p">(\</span><span class="o">.</span><span class="n">multilineTextAlignment</span><span class="p">,</span> <span class="o">.</span><span class="n">center</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">environment</span><span class="p">(\</span><span class="o">.</span><span class="n">lineLimit</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">environment</span><span class="p">(\</span><span class="o">.</span><span class="n">lineSpacing</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">window</span><span class="p">?</span><span class="o">.</span><span class="nf">makeKeyAndVisible</span><span class="p">()</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>In the example above, we made all the text in the app center-aligned with line spacing 8pt without any line limit.</p>

<h4 id="environment-inheritance">Environment inheritance</h4>
<p>Every view inside SwiftUI inherits <em>Environment</em> from its parent view by default. But remember that you can override any values you want while creating the child view by attaching <em>Environment</em> modifier.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">RootView</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">PlayerView</span><span class="p">()</span>
            <span class="o">.</span><span class="nf">environment</span><span class="p">(\</span><span class="o">.</span><span class="n">layoutDirection</span><span class="p">,</span> <span class="o">.</span><span class="n">leftToRight</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">PlayerView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">HStack</span> <span class="p">{</span>
            <span class="kt">Button</span><span class="p">(</span><span class="s">"previous"</span><span class="p">)</span> <span class="p">{</span>

            <span class="p">}</span>
            <span class="kt">Button</span><span class="p">(</span><span class="s">"play"</span><span class="p">)</span> <span class="p">{</span>

            <span class="p">}</span>
            <span class="kt">Button</span><span class="p">(</span><span class="s">"next"</span><span class="p">)</span> <span class="p">{</span>

            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We don’t need to change the order of the buttons on right-to-left locales like Arabic. That’s why <em>RootView</em> set layout direction to <em>leftToRight</em> on <em>PlayerView</em>. It’s important to understand that this modification will apply only to <em>PlayerView</em> and all its child views.</p>

<h4 id="view-specific-environment-values">View specific Environment values</h4>
<p>We already covered how SwiftUI pass system-wide settings via <em>Environment</em>, but this is not the end. SwiftUI uses <em>Environment</em> to inject visible view specific values like <em>isEnabled, editMode, presentationMode, horizontalSizeClass, verticalSizeClass, etc.</em></p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ModalView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@Environment</span><span class="p">(\</span><span class="o">.</span><span class="n">presentationMode</span><span class="p">)</span> <span class="k">var</span> <span class="nv">presentation</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">Button</span><span class="p">(</span><span class="s">"dismiss"</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">presentation</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="nf">dismiss</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we use view-specific environment values to dismiss presented modal view.</p>

<h4 id="custom-environment-keys">Custom Environment keys</h4>
<p>Now we know that SwiftUI provides us plenty of system-wide and view-specific values via the environment. However, I have to mention that we can create a custom environment key and push any value we want into the environment. Let’s take a look at how we can insert custom values into the environment.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>

<span class="kd">struct</span> <span class="kt">ItemsPerPageKey</span><span class="p">:</span> <span class="kt">EnvironmentKey</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">defaultValue</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">10</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">EnvironmentValues</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">itemsPerPage</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">self</span><span class="p">[</span><span class="kt">ItemsPerPageKey</span><span class="o">.</span><span class="k">self</span><span class="p">]</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="k">self</span><span class="p">[</span><span class="kt">ItemsPerPageKey</span><span class="o">.</span><span class="k">self</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">RelatedProductsView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@Environment</span><span class="p">(\</span><span class="o">.</span><span class="n">itemsPerPage</span><span class="p">)</span> <span class="k">var</span> <span class="nv">count</span>

    <span class="k">let</span> <span class="nv">products</span><span class="p">:</span> <span class="p">[</span><span class="kt">Product</span><span class="p">]</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">ForEach</span><span class="p">(</span><span class="n">products</span><span class="p">[</span><span class="o">..&lt;</span><span class="n">count</span><span class="p">],</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span> <span class="n">product</span> <span class="k">in</span>
            <span class="kt">Text</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the example above, we create a custom key that represents a count of items that can be presented on a screen. We also implement a view that uses that environment value. You can easily pass that value to any view you want by using the <em>environment modifier</em>.</p>

<h4 id="dependency-injection-via-environment">Dependency Injection via Environment</h4>
<p>Another great use-case for <em>Environment</em> is Dependency Injection. Every view has its copy of the parent’s <em>Environment</em>, and we can use it to add all <em>ObservableObjects</em> related to the current view.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">CalendarView</span> <span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@EnvironmentObject</span> <span class="k">var</span> <span class="nv">store</span><span class="p">:</span> <span class="kt">CalendarStore</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">NavigationView</span> <span class="p">{</span>
            <span class="kt">List</span> <span class="p">{</span>
                <span class="kt">ForEach</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">sleeps</span><span class="p">)</span> <span class="p">{</span> <span class="n">sleep</span> <span class="k">in</span>
                    <span class="kt">NavigationLink</span><span class="p">(</span>
                        <span class="nv">destination</span><span class="p">:</span> <span class="kt">SleepDetailsView</span><span class="p">()</span>
                            <span class="o">.</span><span class="nf">environmentObject</span><span class="p">(</span><span class="kt">SleepStore</span><span class="p">(</span><span class="nv">sleep</span><span class="p">:</span> <span class="n">sleep</span><span class="p">))</span>
                    <span class="p">)</span> <span class="p">{</span>
                        <span class="kt">CalendarRow</span><span class="p">(</span><span class="nv">sleep</span><span class="p">:</span> <span class="n">sleep</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="o">.</span><span class="nf">navigationBarTitle</span><span class="p">(</span><span class="s">"calendar"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the example above, we use <em>environmentObject</em> modifier to pass an instance of <em>SleepStore</em> object. <em>SleepStore</em> should conform to <em>ObservableObject</em> protocol, which is used by SwiftUI to recreate the view during data changes.</p>

<blockquote>
  <p>To learn more about <em>ObservableObject</em> check another post <a href="/2019/06/05/swiftui-making-real-world-app/">“Making real-world app with SwiftUI”</a>.</p>
</blockquote>

<p>The significant benefit of using <em>Environment</em> and not passing <em>ObservableObject</em> via the <em>init</em> method of the view is the internal SwiftUI storage. SwiftUI stores <em>Environment</em> in the special framework memory outside the view. It gives an implicit access to view-specific <em>Environment</em> for all child views.</p>

<h4 id="conclusion">Conclusion</h4>
<p>As much as I use SwiftUI, I enjoy the concept of <em>Environment</em>. As you can see, it allows us to configure our app’s view hierarchy and make nice Dependency Injection out of the box. I hope you will love <em>Environment</em> feature of SwiftUI. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this post. Thanks for reading and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
