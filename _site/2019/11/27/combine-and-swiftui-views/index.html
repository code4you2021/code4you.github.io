<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Combine and SwiftUI views | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Combine and SwiftUI views" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Combine is one of the new frameworks released during WWDC 2019. It provides a declarative Swift API for processing values over time. Today we will talk about one of the hidden features of SwiftUI views, which is onReceive modifier. It allows views to subscribe and react as soon as the publisher emits the value." />
<meta property="og:description" content="Combine is one of the new frameworks released during WWDC 2019. It provides a declarative Swift API for processing values over time. Today we will talk about one of the hidden features of SwiftUI views, which is onReceive modifier. It allows views to subscribe and react as soon as the publisher emits the value." />
<link rel="canonical" href="http://localhost:4000/2019/11/27/combine-and-swiftui-views/" />
<meta property="og:url" content="http://localhost:4000/2019/11/27/combine-and-swiftui-views/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:image" content="http://localhost:4000/public/combine-and-swiftui-views.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-11-27T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/public/combine-and-swiftui-views.png" />
<meta property="twitter:title" content="Combine and SwiftUI views" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2019/11/27/combine-and-swiftui-views/"},"url":"http://localhost:4000/2019/11/27/combine-and-swiftui-views/","image":"http://localhost:4000/public/combine-and-swiftui-views.png","author":{"@type":"Person","name":"Code4You"},"headline":"Combine and SwiftUI views","description":"Combine is one of the new frameworks released during WWDC 2019. It provides a declarative Swift API for processing values over time. Today we will talk about one of the hidden features of SwiftUI views, which is onReceive modifier. It allows views to subscribe and react as soon as the publisher emits the value.","dateModified":"2019-11-27T00:00:00+08:00","datePublished":"2019-11-27T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">Combine and SwiftUI views</h2>
  <time datetime="2019-11-27T00:00:00+08:00" class="post-date">27 Nov 2019</time>
  <p><em>Combine</em> is one of the new frameworks released during WWDC 2019. It provides a declarative <em>Swift API</em> for processing values over time. Today we will talk about one of the hidden features of SwiftUI views, which is <em>onReceive</em> modifier. It allows views to subscribe and react as soon as the publisher emits the value.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<h4 id="combine">Combine</h4>
<p>We didn’t talk much about Combine on my blog, but I mainly use it for handling asynchronous work. Usually, we have a data layer that is responsible for all operations in the app, like fetching or saving, and this is the place where all asynchronous operations take place. To learn more about the modeling app state, please take a look at <a href="/2019/09/18/redux-like-state-container-in-swiftui/">“Redux-like state container in SwiftUI” post</a>.</p>

<p>But sometimes it is very handy to receive some system-wide notifications in the view layer. An excellent example of this type of notifications can be <em>keyboardWillShowNotification</em>. Framework emits this notification as soon as the system keyboard appears. By listening to this notification, we can understand when to add some bottom padding to the root view to keep it visible above the keyboard.</p>

<p>Let’s take a look at how we can subscribe to the <em>Notification Center</em> using the Combine framework and react to the changes.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span>
    <span class="o">.</span><span class="nf">publisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">UIResponder</span><span class="o">.</span><span class="n">keyboardWillShowNotification</span><span class="p">)</span>
    <span class="o">.</span><span class="n">compactMap</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">userInfo</span><span class="p">?[</span><span class="kt">UIResponder</span><span class="o">.</span><span class="n">keyboardFrameEndUserInfoKey</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">CGRect</span> <span class="p">}</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">height</span> <span class="p">}</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="s">"height: </span><span class="se">\(</span><span class="nv">$0</span><span class="se">)</span><span class="s">"</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div></div>

<p>As you can see in the example above, the Combine framework provides an extension for the <em>Notification Center</em>, which allows us to receive and handle events in a reactive style. Now let’s see how we can use it inside a SwiftUI view.</p>

<h4 id="onreceive-modifier">onReceive modifier</h4>
<p>SwiftUI views provide the <strong>onReceive</strong> modifier, which has two arguments: the <em>Publisher</em> from Combine framework and the closure. SwiftUI subscribes to the publisher and runs passed closure whenever the publisher emits the value. Let’s take a look at the sample code now.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>
<span class="kd">import</span> <span class="kt">Combine</span>

<span class="kd">struct</span> <span class="kt">ItemsView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">items</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>

    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">keyboardHeight</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">keyboardHeightPublisher</span><span class="p">:</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">CGFloat</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kt">Publishers</span><span class="o">.</span><span class="kt">Merge</span><span class="p">(</span>
            <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span>
                <span class="o">.</span><span class="nf">publisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">UIResponder</span><span class="o">.</span><span class="n">keyboardWillShowNotification</span><span class="p">)</span>
                <span class="o">.</span><span class="n">compactMap</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">userInfo</span><span class="p">?[</span><span class="kt">UIResponder</span><span class="o">.</span><span class="n">keyboardFrameEndUserInfoKey</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">CGRect</span> <span class="p">}</span>
                <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">height</span> <span class="p">},</span>
            <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span>
                <span class="o">.</span><span class="nf">publisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">UIResponder</span><span class="o">.</span><span class="n">keyboardWillHideNotification</span><span class="p">)</span>
                <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> <span class="kt">CGFloat</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">List</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">item</span> <span class="k">in</span>
            <span class="kt">Text</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">padding</span><span class="p">(</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="n">keyboardHeight</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">onReceive</span><span class="p">(</span><span class="n">keyboardHeightPublisher</span><span class="p">)</span> <span class="p">{</span> <span class="k">self</span><span class="o">.</span><span class="n">keyboardHeight</span> <span class="o">=</span> <span class="nv">$0</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the example above, we ask SwiftUI to update the state with the value emitted by the publisher, and as soon as state changes, SwiftUI updates our view with a new bottom padding value, which keeps our view above the keyboard. We can extract this piece of code into a <em>ViewModifier</em> to make it more reusable.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>
<span class="kd">import</span> <span class="kt">Combine</span>

<span class="kd">struct</span> <span class="kt">KeyboardAwareModifier</span><span class="p">:</span> <span class="kt">ViewModifier</span> <span class="p">{</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">keyboardHeight</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kd">private</span> <span class="k">var</span> <span class="nv">keyboardHeightPublisher</span><span class="p">:</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">CGFloat</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kt">Publishers</span><span class="o">.</span><span class="kt">Merge</span><span class="p">(</span>
            <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span>
                <span class="o">.</span><span class="nf">publisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">UIResponder</span><span class="o">.</span><span class="n">keyboardWillShowNotification</span><span class="p">)</span>
                <span class="o">.</span><span class="n">compactMap</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">userInfo</span><span class="p">?[</span><span class="kt">UIResponder</span><span class="o">.</span><span class="n">keyboardFrameEndUserInfoKey</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">CGRect</span> <span class="p">}</span>
                <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">height</span> <span class="p">},</span>
            <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span>
                <span class="o">.</span><span class="nf">publisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">UIResponder</span><span class="o">.</span><span class="n">keyboardWillHideNotification</span><span class="p">)</span>
                <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> <span class="kt">CGFloat</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">body</span><span class="p">(</span><span class="nv">content</span><span class="p">:</span> <span class="kt">Content</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="n">content</span>
            <span class="o">.</span><span class="nf">padding</span><span class="p">(</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="n">keyboardHeight</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">onReceive</span><span class="p">(</span><span class="n">keyboardHeightPublisher</span><span class="p">)</span> <span class="p">{</span> <span class="k">self</span><span class="o">.</span><span class="n">keyboardHeight</span> <span class="o">=</span> <span class="nv">$0</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">keyboardAwarePadding</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">ModifiedContent</span><span class="p">(</span><span class="nv">content</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span> <span class="nv">modifier</span><span class="p">:</span> <span class="kt">KeyboardAwareModifier</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To learn more about <a href="/2019/08/07/viewmodifiers-in-swiftui/">ViewModifiers in SwiftUI, take a look at my dedicated post</a>.</p>

<p>Another good example of handling system-wide notifications can be <em>userDidTakeScreenshotNotification</em>. Framework emits this notification as soon the user takes a screenshot of your app. Assume that we are working on the shopping app where we have a product details screen, and we can present a share sheet as soon as the user takes the screenshot of the product. Let’s take a look at how we can achieve this behavior in SwiftUI.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>

<span class="kd">struct</span> <span class="kt">ProductContainerView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">product</span><span class="p">:</span> <span class="kt">Product</span>
    
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">shareShown</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">screenshotPublisher</span><span class="p">:</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Notification</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span>
            <span class="o">.</span><span class="nf">publisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="o">.</span><span class="n">userDidTakeScreenshotNotification</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">ProductDetailsView</span><span class="p">(</span><span class="nv">product</span><span class="p">:</span> <span class="n">product</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">onReceive</span><span class="p">(</span><span class="n">screenshotPublisher</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> <span class="k">self</span><span class="o">.</span><span class="n">shareShown</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">}</span>
            <span class="o">.</span><span class="nf">sheet</span><span class="p">(</span><span class="nv">isPresented</span><span class="p">:</span> <span class="err">$</span><span class="n">shareShown</span><span class="p">)</span> <span class="p">{</span> <span class="kt">ShareView</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we have another excellent example of using the Combine framework in SwiftUI views to present a share sheet as soon as the user takes a screenshot.</p>

<h4 id="conclusion">Conclusion</h4>
<p>Combine framework is a great way to model your data processing, but today we learned about another interesting usage of publishers in combination with SwiftUI views. I hope you enjoy the post. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this post. Thanks for reading, and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
