<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Deep dive into Pattern matching with ~= operator | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Deep dive into Pattern matching with ~= operator" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In one of my previous posts, we talked about the Pattern Matching feature of Swift language. We discussed how we could use “case let” keyword in our daily development to find patterns in Enums, Turples, and Optionals. But today we are going to talk about particular Pattern Matching operator which hides all of this magic behind it." />
<meta property="og:description" content="In one of my previous posts, we talked about the Pattern Matching feature of Swift language. We discussed how we could use “case let” keyword in our daily development to find patterns in Enums, Turples, and Optionals. But today we are going to talk about particular Pattern Matching operator which hides all of this magic behind it." />
<link rel="canonical" href="http://localhost:4000/2019/03/20/pattern-matching-operator/" />
<meta property="og:url" content="http://localhost:4000/2019/03/20/pattern-matching-operator/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-03-20T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Deep dive into Pattern matching with ~= operator" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2019/03/20/pattern-matching-operator/"},"url":"http://localhost:4000/2019/03/20/pattern-matching-operator/","author":{"@type":"Person","name":"Code4You"},"headline":"Deep dive into Pattern matching with ~= operator","description":"In one of my previous posts, we talked about the Pattern Matching feature of Swift language. We discussed how we could use “case let” keyword in our daily development to find patterns in Enums, Turples, and Optionals. But today we are going to talk about particular Pattern Matching operator which hides all of this magic behind it.","dateModified":"2019-03-20T00:00:00+08:00","datePublished":"2019-03-20T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">Deep dive into Pattern matching with ~= operator</h2>
  <time datetime="2019-03-20T00:00:00+08:00" class="post-date">20 Mar 2019</time>
  <p><a href="/2019/02/06/pattern-matching-with-case-let">In one of my previous posts, we talked about the Pattern Matching feature of Swift language</a>. We discussed how we could use “case let” keyword in our daily development to find patterns in Enums, Turples, and Optionals. But today we are going to talk about particular Pattern Matching operator which hides all of this magic behind it.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<p>Pattern Matching is the act of checking a given sequence of tokens for the presence of the constituents of some pattern. Let’s take a look at a simple string matching operation.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">message</span> <span class="o">=</span> <span class="s">"Hello World!"</span>

<span class="k">switch</span> <span class="n">message</span> <span class="p">{</span>
<span class="k">case</span> <span class="s">"Hello"</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"hello"</span><span class="p">)</span>
<span class="k">case</span> <span class="s">"World"</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"world"</span><span class="p">)</span>
<span class="k">case</span> <span class="s">"Hello World!"</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Hello World!"</span><span class="p">)</span>
<span class="k">default</span><span class="p">:</span> <span class="k">break</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can understand this code will print “Hello World!” message in the console. In most of the cases Pattern Matching work as equality check, except Ranges, where it refers to the “contains” method of Range type.</p>

<p>So, the question is “How it is really working?”. Behind the Pattern Matching operation, Swift uses ~= operator, which is overloaded for most of the standard types. While using Pattern Matching, Swift is looking for ~= operator for the current types. Here is an example of how ~= operator looks for String type.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="o">~=</span> <span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">pattern</span> <span class="o">==</span> <span class="n">value</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The good news here is that we can easily overload ~= operator to change this behavior. For example, in the code listing below we change the implementation to custom one, where we instead of equality checking match for containment and now you will see the “Hello” message in the console.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="o">~=</span> <span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">message</span> <span class="o">=</span> <span class="s">"Hello World!"</span>

<span class="k">switch</span> <span class="n">message</span> <span class="p">{</span>
<span class="k">case</span> <span class="s">"Hello"</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"hello"</span><span class="p">)</span>
<span class="k">case</span> <span class="s">"World"</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"world"</span><span class="p">)</span>
<span class="k">case</span> <span class="s">"Hello World!"</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Hello World!"</span><span class="p">)</span>
<span class="k">default</span><span class="p">:</span> <span class="k">break</span>
<span class="p">}</span>
</code></pre></div></div>

<p>There is no magic behind the Pattern Matching. It is just a simple ~= function. We can easily define it for our types and use them in switch statements. Let’s do that.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">User</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">firstName</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">secondName</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">age</span><span class="p">:</span> <span class="kt">Int</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">User</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="o">~=</span> <span class="p">(</span><span class="nv">range</span><span class="p">:</span> <span class="kt">ClosedRange</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">,</span> <span class="nv">user</span><span class="p">:</span> <span class="kt">User</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">range</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="kt">User</span><span class="p">(</span><span class="nv">firstName</span><span class="p">:</span> <span class="s">"Majid"</span><span class="p">,</span> <span class="nv">secondName</span><span class="p">:</span> <span class="s">"Jabrayilov"</span><span class="p">,</span> <span class="nv">age</span><span class="p">:</span> <span class="mi">27</span><span class="p">)</span>

<span class="k">switch</span> <span class="n">user</span> <span class="p">{</span>
<span class="k">case</span> <span class="mi">21</span><span class="o">...</span><span class="mi">30</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"The user age is between 21 and 30"</span><span class="p">)</span>
<span class="k">case</span> <span class="mi">31</span><span class="o">...</span><span class="mi">40</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"The user age is between 31 and 40"</span><span class="p">)</span>
<span class="k">default</span><span class="p">:</span> <span class="k">break</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we have straightforward User struct which contains the name, second name and age fields. I want to be able to use User struct instances in switch statements for matching the age range of my users. Please take a look at the order of parameters in ~= function. The first one describes the case value, where the second one is the value used after the switch keyword. Console output, in this case, is “The user age is between 20 and 30”.</p>

<p>Another good option for overloading Pattern Matching operator can be regular expressions. I want to match the text to multiple regular expression patterns. Let’s dive into the code.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">Regex</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">pattern</span><span class="p">:</span> <span class="kt">String</span>

    <span class="kd">static</span> <span class="k">let</span> <span class="nv">email</span> <span class="o">=</span> <span class="kt">Regex</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="s">"[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+</span><span class="se">\\</span><span class="s">.[A-Za-z]{2,64}"</span><span class="p">)</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">phone</span> <span class="o">=</span> <span class="kt">Regex</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="s">"([+]?1+[-]?)?+([(]?+([0-9]{3})?+[)]?)?+[-]?+[0-9]{3}+[-]?+[0-9]{4}"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Regex</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="o">~=</span><span class="p">(</span><span class="nv">regex</span><span class="p">:</span> <span class="kt">Regex</span><span class="p">,</span> <span class="nv">text</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">regex</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">regularExpression</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">nil</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we have Regex struct which has only one field, and that is the pattern string. We also implement email and phone static constants with predefined regular expressions. Next, we overload ~= operator, in this case, it matches text to our Regex struct by using “range of” method of string type. That’s all we need to use our Regex type for Pattern Matching. Here is the usage example.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">email</span> <span class="o">=</span> <span class="s">"cmecid@gmail.com"</span>

<span class="k">switch</span> <span class="n">email</span> <span class="p">{</span>
<span class="k">case</span> <span class="kt">Regex</span><span class="o">.</span><span class="nv">email</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"email"</span><span class="p">)</span>
<span class="k">case</span> <span class="kt">Regex</span><span class="o">.</span><span class="nv">phone</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"phone"</span><span class="p">)</span>
<span class="k">default</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="s">"default"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Today we discussed how actually is working Pattern Matching in Swift, how easily we can override the logic for standard types and how we can add the ability for Pattern Matching to custom types. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this post. Thanks for reading and see you next week!</p>


</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
