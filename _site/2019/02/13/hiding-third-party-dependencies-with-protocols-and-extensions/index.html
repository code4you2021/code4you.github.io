<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Hiding third-party dependencies with protocols and extensions | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Hiding third-party dependencies with protocols and extensions" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="There are plenty of discussions on the Internet about using third-party dependencies in your apps. The first part of developers suggest ignoring the usage of libraries and write all the code yourself. The second part recommends using third-party dependencies to speed up app development." />
<meta property="og:description" content="There are plenty of discussions on the Internet about using third-party dependencies in your apps. The first part of developers suggest ignoring the usage of libraries and write all the code yourself. The second part recommends using third-party dependencies to speed up app development." />
<link rel="canonical" href="http://localhost:4000/2019/02/13/hiding-third-party-dependencies-with-protocols-and-extensions/" />
<meta property="og:url" content="http://localhost:4000/2019/02/13/hiding-third-party-dependencies-with-protocols-and-extensions/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-02-13T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Hiding third-party dependencies with protocols and extensions" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2019/02/13/hiding-third-party-dependencies-with-protocols-and-extensions/"},"url":"http://localhost:4000/2019/02/13/hiding-third-party-dependencies-with-protocols-and-extensions/","author":{"@type":"Person","name":"Code4You"},"headline":"Hiding third-party dependencies with protocols and extensions","description":"There are plenty of discussions on the Internet about using third-party dependencies in your apps. The first part of developers suggest ignoring the usage of libraries and write all the code yourself. The second part recommends using third-party dependencies to speed up app development.","dateModified":"2019-02-13T00:00:00+08:00","datePublished":"2019-02-13T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">Hiding third-party dependencies with protocols and extensions</h2>
  <time datetime="2019-02-13T00:00:00+08:00" class="post-date">13 Feb 2019</time>
  <p>There are plenty of discussions on the Internet about using third-party dependencies in your apps. The first part of developers suggest ignoring the usage of libraries and write all the code yourself. The second part recommends using third-party dependencies to speed up app development.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<p>Sometimes it is better to use a well-tested library, rather than implementing it yourself. A good example here is Cryptography. Cryptography is hard, and it is effortless to make a mistake during the implementation of some common cryptography algorithms. It is an excellent example of a situation where we should use a third-party library.</p>

<p>But here we can face another problem when the author of the library abandoned it or didn’t update for the next Swift version. In this case, we have to replace this library with another one or implement our solution. It can be tough to remove the library if you use it across the codebase.</p>

<p>So this week we will talk about two techniques which help us to hide our third-party dependencies and make them easy to replace and refactor.</p>

<h4 id="extensions">Extensions</h4>
<p>Most of our apps fetch and display some data via API, very often we have some image URLs which should be downloaded and cached on the disk/memory. There are a lot of great libraries for downloading and caching images from the internet. Most famous is Kingfisher.</p>

<p>It has an extension for UIImageView class which brings setImage method. We can easily use this method anywhere in our codebase by importing Kingfisher framework and calling setImage method on UIImageView.</p>

<p>Assume that we need to replace KingFisher with another library like AlamofireImage. In this case, we have to go through the codebase, replace all Kingfisher imports and setImage method calls to AlamofireImage import and af_setImage method calls respectively. It is going to be tremendous work in case of a huge codebase. Let’s check how we can use extensions to fix this problem.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">Kingfisher</span>

<span class="kd">extension</span> <span class="kt">UIImageView</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">setImage</span><span class="p">(</span><span class="n">from</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">kf</span><span class="o">.</span><span class="nf">setImage</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see in the code sample above, we create an UIImageView extension with setImage method, which calls KingFisher framework’s setImage method. Using this extension across the project give us an opportunity to replace KingFisher framework with any other library with a single file change. The only thing we need to change is the implementation of our setImage method.</p>

<h4 id="protocols">Protocols</h4>
<p>Another excellent example of a third-party dependency can be a Keychain access library. Keychain is the safest place on iOS device to keep user sensitive data like access tokens and passwords. Apple provides us with such ugly string based API for Keychain access, that’s why I decide to use third-party wrapper around Apple’s API. Here is an example of KeychainSwift library usage.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">keychain</span> <span class="o">=</span> <span class="kt">KeychainSwift</span><span class="p">()</span>
<span class="n">keychain</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="s">"hello world"</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="s">"my key"</span><span class="p">)</span>
<span class="n">keychain</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"my key"</span><span class="p">)</span> <span class="c1">// Returns "hello world"</span>
</code></pre></div></div>

<p>KeychainSwift library provides nice key-value API for Keychain access. But I don’t want to expose library usage across the codebase. Let’s create a protocol which defines user sensitive datastore and hides library usage.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">TokenStore</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">accessToken</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span> <span class="k">get</span> <span class="k">set</span> <span class="p">}</span>
    <span class="k">var</span> <span class="nv">refreshToken</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span> <span class="k">get</span> <span class="k">set</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Next step is adding TokenStore protocol conformance to KeychainSwift library.</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">KeychainSwift</span><span class="p">:</span> <span class="kt">TokenStore</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">enum</span> <span class="kt">Keys</span> <span class="p">{</span>
        <span class="kd">static</span> <span class="k">let</span> <span class="nv">accessToken</span> <span class="o">=</span> <span class="s">"accessToken"</span>
        <span class="kd">static</span> <span class="k">let</span> <span class="nv">refreshToken</span> <span class="o">=</span> <span class="s">"refreshToken"</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">accessToken</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">get</span><span class="p">(</span><span class="kt">Keys</span><span class="o">.</span><span class="n">accessToken</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="nf">set</span><span class="p">(</span><span class="n">newValue</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="kt">Keys</span><span class="o">.</span><span class="n">accessToken</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">refreshToken</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">get</span><span class="p">(</span><span class="kt">Keys</span><span class="o">.</span><span class="n">refreshToken</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="nf">set</span><span class="p">(</span><span class="n">newValue</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="kt">Keys</span><span class="o">.</span><span class="n">refreshToken</span><span class="p">)}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And now we can pass TokenStore protocol across our codebase instead of exposing usage of KeychainSwift library.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">AuthenticationService</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">tokenStore</span><span class="p">:</span> <span class="kt">TokenStore</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">tokenStore</span><span class="p">:</span> <span class="kt">TokenStore</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">tokenStore</span> <span class="o">=</span> <span class="n">tokenStore</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">fetchToken</span><span class="p">(</span><span class="k">for</span> <span class="nv">credentials</span><span class="p">:</span> <span class="kt">Credentials</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">//        Save tokens here</span>
<span class="c1">//        tokenStore.accessToken =</span>
<span class="c1">//        tokenStore.refreshToken =</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The single place which knows about KeychainSwift library should be a dependency container which creates AuthenticationService object. More about Dependency Injection we will talk in the next posts.</p>

<h4 id="conclusion">Conclusion</h4>
<p>Today we discussed how we could use protocols and extensions to build tiny abstractions which hide third-party dependencies and make our codebase safer. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this post. Thanks for reading and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
