<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>The power of Delegate design pattern | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="The power of Delegate design pattern" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Last week before WWDC and everybody so excited about new features which we will have just in a few days. However, let’s keep posts related to WWDC for next week. This week we are going to talk about my favorite design pattern Delegate. Delegate is the most straightforward and powerful pattern." />
<meta property="og:description" content="Last week before WWDC and everybody so excited about new features which we will have just in a few days. However, let’s keep posts related to WWDC for next week. This week we are going to talk about my favorite design pattern Delegate. Delegate is the most straightforward and powerful pattern." />
<link rel="canonical" href="http://localhost:4000/2019/05/29/the-power-of-delegate-design-pattern/" />
<meta property="og:url" content="http://localhost:4000/2019/05/29/the-power-of-delegate-design-pattern/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-05-29T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="The power of Delegate design pattern" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2019/05/29/the-power-of-delegate-design-pattern/"},"url":"http://localhost:4000/2019/05/29/the-power-of-delegate-design-pattern/","author":{"@type":"Person","name":"Code4You"},"headline":"The power of Delegate design pattern","description":"Last week before WWDC and everybody so excited about new features which we will have just in a few days. However, let’s keep posts related to WWDC for next week. This week we are going to talk about my favorite design pattern Delegate. Delegate is the most straightforward and powerful pattern.","dateModified":"2019-05-29T00:00:00+08:00","datePublished":"2019-05-29T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">The power of Delegate design pattern</h2>
  <time datetime="2019-05-29T00:00:00+08:00" class="post-date">29 May 2019</time>
  <p>Last week before WWDC and everybody so excited about new features which we will have just in a few days. However, let’s keep posts related to WWDC for next week. This week we are going to talk about my favorite design pattern <em>Delegate</em>. <em>Delegate</em> is the most straightforward and powerful pattern.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<p>In software engineering, the delegation pattern is an object-oriented design pattern that allows object composition to achieve the same code reuse as an inheritance. In delegation, an object handles a request by delegating to a second object (the delegate). A delegate is a helper object, but with the original context.</p>

<h4 id="protocols">Protocols</h4>
<p>We use <em>Delegate</em> pattern every day, and iOS SDK uses it in many places. For example, <em>UITableView</em> delegates to <em>UITableViewDataSource</em> populating the table with cells, it also delegates cell selection and other actions to <em>UITableViewDelegate</em>. Another excellent example of delegate patters is <em>FlowController</em> or <em>Coordinators</em>. <em>ViewControllers</em> delegates navigation logic to <em>Coordinator</em>. I have separated post about <a href="/2019/02/20/navigation-with-flow-controllers">extracting navigation logic into FlowControllers</a>.</p>

<p>Let’s dive into code samples. Assume that you are working on a game. You extracted game logic into separated class Game, and you want to delegate game state changes to <em>UIViewController</em> which renders this game.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">GameDelegate</span><span class="p">:</span> <span class="kt">AnyObject</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">stateChanged</span><span class="p">(</span><span class="n">from</span> <span class="nv">oldState</span><span class="p">:</span> <span class="kt">Game</span><span class="o">.</span><span class="kt">State</span><span class="p">,</span> <span class="n">to</span> <span class="nv">newState</span><span class="p">:</span> <span class="kt">Game</span><span class="o">.</span><span class="kt">State</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">Game</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">State</span> <span class="o">=</span> <span class="o">.</span><span class="n">notStarted</span> <span class="p">{</span>
        <span class="k">didSet</span> <span class="p">{</span>
            <span class="n">delegate</span><span class="p">?</span><span class="o">.</span><span class="nf">stateChanged</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">oldValue</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="n">state</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">weak</span> <span class="k">var</span> <span class="nv">delegate</span><span class="p">:</span> <span class="kt">GameDelegate</span><span class="p">?</span>

    <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kd">func</span> <span class="nf">start</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">state</span> <span class="o">=</span> <span class="o">.</span><span class="n">started</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">generateNextValue</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">value</span> <span class="o">=</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">random</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="mi">0</span><span class="o">..&lt;</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="nf">generateState</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="n">value</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Game</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">State</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">notStarted</span>
        <span class="k">case</span> <span class="n">started</span>
        <span class="k">case</span> <span class="n">right</span>
        <span class="k">case</span> <span class="n">win</span>
        <span class="k">case</span> <span class="n">lost</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here is the source code of a simple game which generates random values. The game engine generates state based on random values. Every state change call delegate to pass old and new states. We define our delegate protocol extended from <em>AnyObject</em>, that means the only class instance can accept it. I also use <strong>weak</strong> keyword to define variable holding delegate. It needed to break the retain cycle between delegate and game class. Let’s take a look at <em>GameViewController</em> now.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">GameViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">game</span><span class="p">:</span> <span class="kt">Game</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">game</span><span class="p">:</span> <span class="kt">Game</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">game</span> <span class="o">=</span> <span class="n">game</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">nibName</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">bundle</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">play</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">game</span><span class="o">.</span><span class="nf">start</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">game</span><span class="o">.</span><span class="nf">generateNextValue</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="n">game</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">GameViewController</span><span class="p">:</span> <span class="kt">GameDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">render</span><span class="p">(</span><span class="n">_</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">Game</span><span class="o">.</span><span class="kt">State</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">state</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">lost</span><span class="p">:</span> <span class="nf">renderLost</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">right</span><span class="p">:</span> <span class="nf">renderRight</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">win</span><span class="p">:</span> <span class="nf">renderWin</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">started</span><span class="p">:</span> <span class="nf">renderStart</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">notStarted</span><span class="p">:</span> <span class="nf">renderNotStarted</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">stateChanged</span><span class="p">(</span><span class="n">from</span> <span class="nv">oldState</span><span class="p">:</span> <span class="kt">Game</span><span class="o">.</span><span class="kt">State</span><span class="p">,</span> <span class="n">to</span> <span class="nv">newState</span><span class="p">:</span> <span class="kt">Game</span><span class="o">.</span><span class="kt">State</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">render</span><span class="p">(</span><span class="n">newState</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we have a <em>GameViewController</em> class which feeds game with user actions and render state changes. <em>GameViewController</em> conforms to <em>GameDelegate</em> and implements all needed rendering in extension. As a result, we have a composable codebase with the help of <em>Delegate</em> design pattern.</p>

<h4 id="closures">Closures</h4>

<p>Sometimes when you have only one method in the delegate, you can replace it with closure. The idea is the same, but now you call the closure and pass the state instead of calling the method by protocol. Let’s take a look at the example with closure.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">Game</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">StateHandler</span> <span class="o">=</span> <span class="p">(</span><span class="kt">State</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span>

    <span class="k">var</span> <span class="nv">handler</span><span class="p">:</span> <span class="kt">StateHandler</span><span class="p">?</span>
    
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">State</span> <span class="o">=</span> <span class="o">.</span><span class="n">notStarted</span> <span class="p">{</span>
        <span class="k">didSet</span> <span class="p">{</span>
            <span class="nf">handler</span><span class="p">?(</span><span class="n">state</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">GameViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="n">game</span><span class="o">.</span><span class="n">handler</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">state</span> <span class="k">in</span>
            <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="nf">render</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see, we pass the closure to the game class instance which handles state changes. We use <strong>weak</strong> to break the retain cycle during closure’s context capture. Another option here can be a usage of the fact that any Swift function is a closure. So instead of creating separated closure, we can pass the function name. However, be careful this method creates retain circle. Here is an example of how we can do that.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">GameViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="n">game</span><span class="o">.</span><span class="n">handler</span> <span class="o">=</span> <span class="n">render</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">GameViewController</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">render</span><span class="p">(</span><span class="n">_</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">Game</span><span class="o">.</span><span class="kt">State</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">state</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">lost</span><span class="p">:</span> <span class="nf">renderLost</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">right</span><span class="p">:</span> <span class="nf">renderRight</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">win</span><span class="p">:</span> <span class="nf">renderWin</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">started</span><span class="p">:</span> <span class="nf">renderStart</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">notStarted</span><span class="p">:</span> <span class="nf">renderNotStarted</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="conclusion">Conclusion</h4>

<p>Today we discussed the most powerful and straightforward design pattern in iOS development. I enjoy how simple it is and how useful it can be in composing pieces to make codebase decoupled. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this post. Thanks for reading and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
