<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Building Bottom sheet in SwiftUI | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Building Bottom sheet in SwiftUI" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This week I want to start a series of posts about building interactive view components that Apple heavily uses in its apps but doesn’t include them into the SDK. Let’s begin with the bottom sheet. I think everybody used Apple Maps, Shortcut or Apple Music apps. There is a draggable sheet at the bottom of the screen. It looks like bottom sheet is going to be a must-use component, so let’s try to implement it in SwiftUI." />
<meta property="og:description" content="This week I want to start a series of posts about building interactive view components that Apple heavily uses in its apps but doesn’t include them into the SDK. Let’s begin with the bottom sheet. I think everybody used Apple Maps, Shortcut or Apple Music apps. There is a draggable sheet at the bottom of the screen. It looks like bottom sheet is going to be a must-use component, so let’s try to implement it in SwiftUI." />
<link rel="canonical" href="http://localhost:4000/2019/12/11/building-bottom-sheet-in-swiftui/" />
<meta property="og:url" content="http://localhost:4000/2019/12/11/building-bottom-sheet-in-swiftui/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:image" content="http://localhost:4000/public/bottom-sheet.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-12-11T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/public/bottom-sheet.png" />
<meta property="twitter:title" content="Building Bottom sheet in SwiftUI" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2019/12/11/building-bottom-sheet-in-swiftui/"},"url":"http://localhost:4000/2019/12/11/building-bottom-sheet-in-swiftui/","image":"http://localhost:4000/public/bottom-sheet.png","author":{"@type":"Person","name":"Code4You"},"headline":"Building Bottom sheet in SwiftUI","description":"This week I want to start a series of posts about building interactive view components that Apple heavily uses in its apps but doesn’t include them into the SDK. Let’s begin with the bottom sheet. I think everybody used Apple Maps, Shortcut or Apple Music apps. There is a draggable sheet at the bottom of the screen. It looks like bottom sheet is going to be a must-use component, so let’s try to implement it in SwiftUI.","dateModified":"2019-12-11T00:00:00+08:00","datePublished":"2019-12-11T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">Building Bottom sheet in SwiftUI</h2>
  <time datetime="2019-12-11T00:00:00+08:00" class="post-date">11 Dec 2019</time>
  <p>This week I want to start a series of posts about building interactive view components that Apple heavily uses in its apps but doesn’t include them into the SDK. Let’s begin with the bottom sheet. I think everybody used Apple Maps, Shortcut or Apple Music apps. There is a draggable sheet at the bottom of the screen. It looks like bottom sheet is going to be a must-use component, so let’s try to implement it in SwiftUI.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<p>Usually, when I deal with interactive components, I start with implementing the component in different states. After that, we can add the gesture which manipulates the state of the component. In our case, we deal with the bottom sheet. It has two different states: <em>open</em> and <em>closed</em>. Let’s start by describing our view and all the needed properties which should be passed by the parent view.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>

<span class="kd">struct</span> <span class="kt">BottomSheetView</span><span class="o">&lt;</span><span class="kt">Content</span><span class="p">:</span> <span class="kt">View</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@Binding</span> <span class="k">var</span> <span class="nv">isOpen</span><span class="p">:</span> <span class="kt">Bool</span>

    <span class="k">let</span> <span class="nv">maxHeight</span><span class="p">:</span> <span class="kt">CGFloat</span>
    <span class="k">let</span> <span class="nv">minHeight</span><span class="p">:</span> <span class="kt">CGFloat</span>
    <span class="k">let</span> <span class="nv">content</span><span class="p">:</span> <span class="kt">Content</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">isOpen</span><span class="p">:</span> <span class="kt">Binding</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="o">&gt;</span><span class="p">,</span> <span class="nv">maxHeight</span><span class="p">:</span> <span class="kt">CGFloat</span><span class="p">,</span> <span class="kd">@ViewBuilder</span> <span class="nv">content</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Content</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">minHeight</span> <span class="o">=</span> <span class="n">maxHeight</span> <span class="o">*</span> <span class="kt">Constants</span><span class="o">.</span><span class="n">minHeightRatio</span>
        <span class="k">self</span><span class="o">.</span><span class="n">maxHeight</span> <span class="o">=</span> <span class="n">maxHeight</span>
        <span class="k">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="nf">content</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">_isOpen</span> <span class="o">=</span> <span class="n">isOpen</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see, we started with defining a few properties of <em>BottomSheetView</em>. First of all, it needs a binding to its state. By using binding, we extract the state from the bottom sheet itself and allow the parent view to open/close the sheet.</p>

<blockquote>
  <p>To learn more about the benefits of <em>@Binding</em> take a look at <a href="/2019/06/12/understanding-property-wrappers-in-swiftui/">“Understanding Property Wrappers in SwiftUI”</a> post.</p>
</blockquote>

<p>We also require the maximum height which we will use whenever the sheet is open, and we calculate the minimum height to use it whenever the sheet is closed.</p>

<p>The last parameter we need is the content closure with <em>@ViewBuilder</em> function builder. <em>@ViewBuilder</em> allows us to use closure to build the content view of our bottom sheet. Other view containers like <em>VStack, HStack, ZStack</em> also use <em>@ViewBuilder</em> to describe content closure. Let’s make it similar to standard SwiftUI components.</p>

<p>We already defined all the needed public properties. Let’s place the content now.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="k">var</span> <span class="nv">offset</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="p">{</span>
    <span class="n">isOpen</span> <span class="p">?</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">maxHeight</span> <span class="o">-</span> <span class="n">minHeight</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="k">var</span> <span class="nv">indicator</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kt">RoundedRectangle</span><span class="p">(</span><span class="nv">cornerRadius</span><span class="p">:</span> <span class="kt">Constants</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">fill</span><span class="p">(</span><span class="kt">Color</span><span class="o">.</span><span class="n">secondary</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">frame</span><span class="p">(</span>
            <span class="nv">width</span><span class="p">:</span> <span class="kt">Constants</span><span class="o">.</span><span class="n">indicatorWidth</span><span class="p">,</span>
            <span class="nv">height</span><span class="p">:</span> <span class="kt">Constants</span><span class="o">.</span><span class="n">indicatorHeight</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kt">GeometryReader</span> <span class="p">{</span> <span class="n">geometry</span> <span class="k">in</span>
        <span class="kt">VStack</span><span class="p">(</span><span class="nv">spacing</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">indicator</span><span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
            <span class="k">self</span><span class="o">.</span><span class="n">content</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">maxHeight</span><span class="p">,</span> <span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">background</span><span class="p">(</span><span class="kt">Color</span><span class="p">(</span><span class="o">.</span><span class="n">secondarySystemBackground</span><span class="p">))</span>
        <span class="o">.</span><span class="nf">cornerRadius</span><span class="p">(</span><span class="kt">Constants</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">height</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">bottom</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">offset</span><span class="p">(</span><span class="nv">y</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The vertical stack is all we need to place the dragging indicator and content of the bottom sheet. We also use <em>Shape API</em> to draw the dragging symbol programmatically, which is really simple. <em>GeometryReader</em> provides all the needed information about the size of the parent view that allows us properly place our view. We use the <em>offset</em> modifier to move our view, depending on its state.</p>

<blockquote>
  <p>To learn more about <em>Shape API</em> and <em>GeometryReader</em> take a look at <a href="/2019/08/14/building-barchart-with-shape-api-in-swiftui/">“Building BarChart with Shape API in SwiftUI”</a> post.</p>
</blockquote>

<p>The last step is to attach the drag gesture and move the view whenever the user drags the finger. Let’s see how we can do that.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@GestureState</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">translation</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kt">GeometryReader</span> <span class="p">{</span> <span class="n">geometry</span> <span class="k">in</span>
        <span class="kt">VStack</span><span class="p">(</span><span class="nv">spacing</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">indicator</span><span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
            <span class="k">self</span><span class="o">.</span><span class="n">content</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">maxHeight</span><span class="p">,</span> <span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">background</span><span class="p">(</span><span class="kt">Color</span><span class="p">(</span><span class="o">.</span><span class="n">secondarySystemBackground</span><span class="p">))</span>
        <span class="o">.</span><span class="nf">cornerRadius</span><span class="p">(</span><span class="kt">Constants</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">height</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">bottom</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">offset</span><span class="p">(</span><span class="nv">y</span><span class="p">:</span> <span class="nf">max</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="k">self</span><span class="o">.</span><span class="n">translation</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="o">.</span><span class="nf">animation</span><span class="p">(</span><span class="o">.</span><span class="nf">interactiveSpring</span><span class="p">(),</span> <span class="nv">value</span><span class="p">:</span> <span class="n">isOpen</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">animation</span><span class="p">(</span><span class="o">.</span><span class="nf">interactiveSpring</span><span class="p">(),</span> <span class="nv">value</span><span class="p">:</span> <span class="n">translation</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">gesture</span><span class="p">(</span>
            <span class="kt">DragGesture</span><span class="p">()</span><span class="o">.</span><span class="nf">updating</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="err">$</span><span class="n">translation</span><span class="p">)</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">height</span>
            <span class="p">}</span><span class="o">.</span><span class="n">onEnded</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
                <span class="k">let</span> <span class="nv">snapDistance</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">maxHeight</span> <span class="o">*</span> <span class="kt">Constants</span><span class="o">.</span><span class="n">snapRatio</span>
                <span class="k">guard</span> <span class="nf">abs</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">snapDistance</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span>
                <span class="p">}</span>
                <span class="k">self</span><span class="o">.</span><span class="n">isOpen</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">height</span> <span class="o">&lt;</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the code sample above, we attach the drag gesture to the view and modify its state as soon as it ends. Besides that, we update the gesture state to make it interactive. The main benefit of <em>@GestureState</em> is its behavior. SwiftUI resets the value of the <em>@GestureState</em> to its initial value as soon as gesture ends. We use the value of <em>@GestureState</em> by adding it to the offset, which allows us to drive our view interactively.</p>

<blockquote>
  <p>To learn more about <em>gestures</em> and <em>@GestureState</em> take a look at <a href="/2019/07/10/gestures-in-swiftui/">“Gestures in SwiftUI”</a> post.</p>
</blockquote>

<p>Let’s finally use our bottom sheet to check how it works.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">bottomSheetShown</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">GeometryReader</span> <span class="p">{</span> <span class="n">geometry</span> <span class="k">in</span>
            <span class="kt">Color</span><span class="o">.</span><span class="n">green</span>
            <span class="kt">BottomSheetView</span><span class="p">(</span>
                <span class="nv">isOpen</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="err">$</span><span class="n">bottomSheetShown</span><span class="p">,</span>
                <span class="nv">maxHeight</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="mf">0.7</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="kt">Color</span><span class="o">.</span><span class="n">blue</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="o">.</span><span class="nf">edgesIgnoringSafeArea</span><span class="p">(</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/public/bottom-sheet.png" alt="bottom-sheet" /></p>

<blockquote>
  <p>Full source code available <a href="https://gist.github.com/mecid/78eab34d05498d6c60ae0f162bfd81ee">here</a></p>
</blockquote>

<h4 id="conclusion">Conclusion</h4>
<p>Today we learned how we could build a draggable bottom sheet component, which Apple uses a lot in its apps. Building interactive components is really straightforward in SwiftUI. All you need to do is defining the state and the gesture which modifies the state. SwiftUI animates all the transitions between state changes for free for you. I hope you enjoy the post. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this post. Thanks for reading, and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
