<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>FocusedValue and FocusedBinding property wrappers in SwiftUI | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="FocusedValue and FocusedBinding property wrappers in SwiftUI" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The last year Apple has done a great job in terms of focus management in SwiftUI. We got a few new modifiers to set up an entry point for the focus system and programmatically handle focus changes. We still have some gaps, and I hope Apple will fill them during WWDC21. This week I want to talk about FocusedValue and FocusedBinding property wrappers." />
<meta property="og:description" content="The last year Apple has done a great job in terms of focus management in SwiftUI. We got a few new modifiers to set up an entry point for the focus system and programmatically handle focus changes. We still have some gaps, and I hope Apple will fill them during WWDC21. This week I want to talk about FocusedValue and FocusedBinding property wrappers." />
<link rel="canonical" href="http://localhost:4000/2021/03/03/focusedvalue-and-focusedbinding-property-wrappers-in-swiftui/" />
<meta property="og:url" content="http://localhost:4000/2021/03/03/focusedvalue-and-focusedbinding-property-wrappers-in-swiftui/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:image" content="http://localhost:4000/public/tabs.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-03T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/public/tabs.png" />
<meta property="twitter:title" content="FocusedValue and FocusedBinding property wrappers in SwiftUI" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/03/03/focusedvalue-and-focusedbinding-property-wrappers-in-swiftui/"},"url":"http://localhost:4000/2021/03/03/focusedvalue-and-focusedbinding-property-wrappers-in-swiftui/","image":"http://localhost:4000/public/tabs.png","author":{"@type":"Person","name":"Code4You"},"headline":"FocusedValue and FocusedBinding property wrappers in SwiftUI","description":"The last year Apple has done a great job in terms of focus management in SwiftUI. We got a few new modifiers to set up an entry point for the focus system and programmatically handle focus changes. We still have some gaps, and I hope Apple will fill them during WWDC21. This week I want to talk about FocusedValue and FocusedBinding property wrappers.","dateModified":"2021-03-03T00:00:00+08:00","datePublished":"2021-03-03T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">FocusedValue and FocusedBinding property wrappers in SwiftUI</h2>
  <time datetime="2021-03-03T00:00:00+08:00" class="post-date">03 Mar 2021</time>
  <p>The last year Apple has done a great job in terms of focus management in SwiftUI. We got a few new modifiers to set up an entry point for the focus system and programmatically handle focus changes. We still have some gaps, and I hope Apple will fill them during WWDC21. This week I want to talk about <em>FocusedValue</em> and <em>FocusedBinding</em> property wrappers.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<h4 id="focusedvalue">FocusedValue</h4>
<p><em>FocusedValue</em> property wrapper allows us to observe the value from the focused view or one of its ancestors. It works in a very similar way to the <em>Environment</em> property wrapper, but instead of observing the environment, it observes the view hierarchy’s focused view.</p>

<blockquote>
  <p>To learn more about the basics of focus management in SwiftUI, take a look at my dedicated <a href="/2020/12/02/focus-management-in-swiftui/">post</a>.</p>
</blockquote>

<p>To start using this feature, you should first create a struct that conforms to <em>FocusedValueKey</em> to define the type of value you want to observe. Assume that we are working on the note-taking app, and we want to monitor the content of the focused note editor. Let’s try to implement this.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">FocusedNoteValue</span><span class="p">:</span> <span class="kt">FocusedValueKey</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">Value</span> <span class="o">=</span> <span class="kt">String</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see in the example above, we create the <em>FocusedNoteValue</em> struct and conform to the <em>FocusedValueKey</em> protocol. The only thing we need to do is adding a type alias for the <em>Value</em> type. The <em>Value</em> type here is our content that we want to observe when a view is focused. In our case, it is <em>String</em> because we want to monitor the note that the user edits at the moment.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">FocusedValues</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">noteValue</span><span class="p">:</span> <span class="kt">FocusedNoteValue</span><span class="o">.</span><span class="kt">Value</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">self</span><span class="p">[</span><span class="kt">FocusedNoteValue</span><span class="o">.</span><span class="k">self</span><span class="p">]</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="k">self</span><span class="p">[</span><span class="kt">FocusedNoteValue</span><span class="o">.</span><span class="k">self</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we provide an extension for <em>FocusedValues</em> where we register a getter and setter for our custom focused value. Make sure it is optional. SwiftUI set it to nil when the view is not focused.</p>

<blockquote>
  <p>To learn more about providing custom values via SwiftUI’s Environment, take a look at my <a href="/2019/08/21/the-power-of-environment-in-swiftui/">“The power of Environment in SwiftUI”</a> post.</p>
</blockquote>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">Group</span> <span class="p">{</span>
            <span class="kt">NoteEditor</span><span class="p">()</span>
            <span class="kt">NotePreview</span><span class="p">()</span>
        <span class="p">}</span><span class="o">.</span><span class="nf">border</span><span class="p">(</span><span class="kt">Color</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">NoteEditor</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">note</span> <span class="o">=</span> <span class="s">"text"</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">TextEditor</span><span class="p">(</span><span class="nv">text</span><span class="p">:</span> <span class="err">$</span><span class="n">note</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">300</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">focusedValue</span><span class="p">(\</span><span class="o">.</span><span class="n">noteValue</span><span class="p">,</span> <span class="n">note</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">NotePreview</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@FocusedValue</span><span class="p">(\</span><span class="o">.</span><span class="n">noteValue</span><span class="p">)</span> <span class="k">var</span> <span class="nv">note</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">Text</span><span class="p">(</span><span class="n">note</span> <span class="p">??</span> <span class="s">"Note is not focused"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we have the <em>ContentView</em> with <em>NoteEditor</em> that uses a binding from the view state to store the note content. We use the <em>focusedValue</em> modifier to save note content into the special memory that SwiftUI control and only assign when the view is focused.</p>

<p>We also define the <em>NotePreview</em> view. <em>NotePreview</em> uses the <em>FocusedValue</em> property wrapper to monitor the content of the focused note. SwiftUI will set the value of <em>FocusedValue</em> to <em>nil</em> as soon as the view loses the focus.</p>

<h4 id="focusedbinding">FocusedBinding</h4>
<p>OK, we learned how to pass a read-only value for a recently focused note. But what if we want to modify it? For example, we can have a <em>NoteFormatter</em> view that formats the note’s content and overrides it. We can’t achieve it with the <em>FocusedValue</em> property wrapper because it provides us a get-only value.</p>

<p>In this case, we can use the <em>FocusedBinding</em> property wrapper. It works in the very same way, but instead of the read-only value, it provides a binding that we can use to override the content. Let’s start by extending the <em>FocusedValues</em> struct with a custom key for note content binding.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">FocusedNoteBinding</span><span class="p">:</span> <span class="kt">FocusedValueKey</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">Value</span> <span class="o">=</span> <span class="kt">Binding</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">FocusedValues</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">noteBinding</span><span class="p">:</span> <span class="kt">FocusedNoteBinding</span><span class="o">.</span><span class="kt">Value</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">self</span><span class="p">[</span><span class="kt">FocusedNoteBinding</span><span class="o">.</span><span class="k">self</span><span class="p">]</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="k">self</span><span class="p">[</span><span class="kt">FocusedNoteBinding</span><span class="o">.</span><span class="k">self</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now we can create the <em>NoteFormatter</em> view, which uses the <em>FocusedBinding</em> property wrapper, and override the note content using the binding.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">Group</span> <span class="p">{</span>
            <span class="kt">NoteEditor</span><span class="p">()</span>
            <span class="kt">NoteFormatter</span><span class="p">()</span>
        <span class="p">}</span><span class="o">.</span><span class="nf">border</span><span class="p">(</span><span class="kt">Color</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">NoteEditor</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">note</span> <span class="o">=</span> <span class="s">"text"</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">TextEditor</span><span class="p">(</span><span class="nv">text</span><span class="p">:</span> <span class="err">$</span><span class="n">note</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">300</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">focusedValue</span><span class="p">(\</span><span class="o">.</span><span class="n">noteBinding</span><span class="p">,</span> <span class="err">$</span><span class="n">note</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">NoteFormatter</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@FocusedBinding</span><span class="p">(\</span><span class="o">.</span><span class="n">noteBinding</span><span class="p">)</span> <span class="k">var</span> <span class="nv">note</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="kt">Text</span><span class="p">(</span><span class="n">note</span> <span class="p">??</span> <span class="s">"Note is not focused"</span><span class="p">)</span>
            <span class="kt">Button</span><span class="p">(</span><span class="s">"Clear note"</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">note</span> <span class="o">=</span> <span class="s">""</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="conclusion">Conclusion</h4>
<p>Today we learned how to use <em>FocusedValue</em> and <em>FocusedBinding</em> property wrappers. One of the possible use cases for these property wrappers is commands that we can use to create the main menu for macOS apps. You can access the currently focused view’s content and implement some logic that lives in your macOS app’s main menu.</p>

<blockquote>
  <p>To learn more about building the main menu for macOS apps, take a look at my <a href="/2020/11/24/commands-in-swiftui/">“Commands in SwiftUI”</a> post.</p>
</blockquote>

<p>I hope you enjoy the post. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this article. Thanks for reading, and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
