<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Combining multiple Combine publishers in Swift | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Combining multiple Combine publishers in Swift" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’ve already covered a few essential topics from the Combine framework story. We talked about handling errors and chaining operations, but today I want to talk about running multiple operations in parallel and handing results in a single place. This week we will learn how to use zip, merge and combine operators." />
<meta property="og:description" content="I’ve already covered a few essential topics from the Combine framework story. We talked about handling errors and chaining operations, but today I want to talk about running multiple operations in parallel and handing results in a single place. This week we will learn how to use zip, merge and combine operators." />
<link rel="canonical" href="http://localhost:4000/2021/05/12/combining-multiple-combine-publishers-in-swift/" />
<meta property="og:url" content="http://localhost:4000/2021/05/12/combining-multiple-combine-publishers-in-swift/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:image" content="http://localhost:4000/public/combine.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-05-12T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/public/combine.png" />
<meta property="twitter:title" content="Combining multiple Combine publishers in Swift" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/05/12/combining-multiple-combine-publishers-in-swift/"},"url":"http://localhost:4000/2021/05/12/combining-multiple-combine-publishers-in-swift/","image":"http://localhost:4000/public/combine.png","author":{"@type":"Person","name":"Code4You"},"headline":"Combining multiple Combine publishers in Swift","description":"I’ve already covered a few essential topics from the Combine framework story. We talked about handling errors and chaining operations, but today I want to talk about running multiple operations in parallel and handing results in a single place. This week we will learn how to use zip, merge and combine operators.","dateModified":"2021-05-12T00:00:00+08:00","datePublished":"2021-05-12T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">Combining multiple Combine publishers in Swift</h2>
  <time datetime="2021-05-12T00:00:00+08:00" class="post-date">12 May 2021</time>
  <p>I’ve already covered a few essential topics from the Combine framework story. We talked about handling errors and chaining operations, but today I want to talk about running multiple operations in parallel and handing results in a single place. This week we will learn how to use zip, merge and combine operators.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<h4 id="zip">Zip</h4>
<p><em>Zip</em> operator is handy when you have a couple of publishers and need to wait for values from both of them. For example, assume that you are working on some kind of store app. You have a product screen where you show product details and the list of related products. In this case, you might want to display details and associated products at the same time. You can achieve this behavior using the <em>Zip</em> operator.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="kd">class</span> <span class="kt">ProductViewModel</span><span class="p">:</span> <span class="kt">ObservableObject</span> <span class="p">{</span>
    <span class="kd">@Published</span> <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">product</span><span class="p">:</span> <span class="kt">Product</span><span class="p">?</span>
    <span class="kd">@Published</span> <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">related</span><span class="p">:</span> <span class="p">[</span><span class="kt">Product</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">let</span> <span class="nv">service</span> <span class="o">=</span> <span class="kt">ProductsService</span><span class="p">()</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">cancellable</span><span class="p">:</span> <span class="kt">AnyCancellable</span><span class="p">?</span>

    <span class="kd">func</span> <span class="nf">fetch</span><span class="p">(</span><span class="n">_</span> <span class="nv">product</span><span class="p">:</span> <span class="kt">UUID</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cancellable</span> <span class="o">=</span> <span class="kt">Publishers</span><span class="o">.</span><span class="kt">Zip</span><span class="p">(</span>
            <span class="n">service</span><span class="o">.</span><span class="nf">fetch</span><span class="p">(</span><span class="n">product</span><span class="p">),</span>
            <span class="n">service</span><span class="o">.</span><span class="nf">fetchRelatedProducts</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">product</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="nf">sink</span><span class="p">(</span>
            <span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
            <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">product</span><span class="p">,</span> <span class="n">related</span> <span class="k">in</span>
                <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="n">product</span> <span class="o">=</span> <span class="n">product</span>
                <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="n">related</span> <span class="o">=</span> <span class="n">related</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>To learn more about designing API with Combine publishers, take a look at my <a href="/2021/04/07/designing-api-using-combine-framework/">“Designing API using Combine framework”</a> post.</p>
</blockquote>

<p>As you can see in the example above, we use <em>Zip</em> to fetch product details and related products. As soon as both publishers emit the value <em>sink</em> subscriber will assign them to the stored properties.</p>

<h4 id="combinelatest">CombineLatest</h4>
<p>The main downside of the <em>Zip</em> operator is that it delivers values only when all the publishers emit. Sometimes we want to obtain all the values even when some of them change more often than others. For example, assume that you are working on a signup screen where you have text fields for email, password, and repeated password. You also have a signup button that should be enabled when all the text fields contain valid data.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="kd">class</span> <span class="kt">SignUpViewModel</span><span class="p">:</span> <span class="kt">ObservableObject</span> <span class="p">{</span>
    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span>
    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">password1</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span>
    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">password2</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span>

    <span class="k">var</span> <span class="nv">isValid</span><span class="p">:</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kt">Publishers</span>
            <span class="o">.</span><span class="kt">CombineLatest3</span><span class="p">(</span><span class="err">$</span><span class="n">email</span><span class="p">,</span> <span class="err">$</span><span class="n">password1</span><span class="p">,</span> <span class="err">$</span><span class="n">password2</span><span class="p">)</span>
            <span class="o">.</span><span class="n">allSatisfy</span> <span class="p">{</span> <span class="n">email</span><span class="p">,</span> <span class="n">password1</span><span class="p">,</span> <span class="n">password2</span> <span class="k">in</span>
                <span class="n">email</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"@"</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                    <span class="n">password1</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">7</span> <span class="o">&amp;&amp;</span>
                    <span class="n">password1</span> <span class="o">==</span> <span class="n">password2</span>
            <span class="p">}</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we have the signup screen’s view model. It contains a few stored properties which we are going to use in our view. It also has <em>isValid</em> computed property that creates a validation publisher.</p>

<p>As you can see, we use the <em>CombineLatest</em> operator to obtain the latest values from all the publishers. <em>CombineLatest</em> publisher collects the first value from all three publishers and emits them as a single tuple. <em>CombineLatest</em> continues sending new values even when only one publisher emits a new value.</p>

<p>On the other hand, the <em>Zip</em> operator sends a new value only when all the publishers emit new values.</p>

<h4 id="mergemany">MergeMany</h4>
<p><em>Merge</em> is another helpful operator provided by the Combine framework that you can use to join a few different publishers with the same output type. I often use the <em>Merge</em> operator while fetching locally cached data and fetching new data from the webserver.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="kd">class</span> <span class="kt">FavoritesViewModel</span><span class="p">:</span> <span class="kt">ObservableObject</span> <span class="p">{</span>
    <span class="kd">@Published</span> <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">products</span><span class="p">:</span> <span class="p">[</span><span class="kt">Product</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">let</span> <span class="nv">service</span> <span class="o">=</span> <span class="kt">ProductsService</span><span class="p">()</span>

    <span class="kd">func</span> <span class="nf">fetch</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">Publishers</span><span class="o">.</span><span class="kt">MergeMany</span><span class="p">(</span>
            <span class="n">service</span><span class="o">.</span><span class="nf">fetchCachedFavorites</span><span class="p">(),</span>
            <span class="n">service</span><span class="o">.</span><span class="nf">fetchFavorites</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="nf">replaceError</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="p">[])</span>
        <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="o">&amp;</span><span class="err">$</span><span class="n">products</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see, the <em>MergeMany</em> operator allows me to create a single pipe for cached and fresh data where the cached information usually appears first and then replaced by new data.</p>

<blockquote>
  <p>To learn about building custom Combine operators, take a look at my <a href="/2021/04/28/building-custom-combine-operators-in-swift/">“Building custom Combine operators in Swift”</a> post.</p>
</blockquote>

<h4 id="conclusion">Conclusion</h4>
<p>This week we learned about operators of the Combine framework, which allows us to build complex data pipelines by zipping and merging multiple publishers. I hope you enjoy the post. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this post. Thanks for reading, and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
