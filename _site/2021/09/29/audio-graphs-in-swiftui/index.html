<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Audio graphs in SwiftUI | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Audio graphs in SwiftUI" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Charts and graphs are one of the complicated things in terms of accessibility. Fortunately, iOS 15 has a new feature called Audio Graphs. This week we will learn how to build an audio representation for any SwiftUI view presenting a chart like a custom bar chart view or an image by using the accessibilityChartDescriptor view modifier." />
<meta property="og:description" content="Charts and graphs are one of the complicated things in terms of accessibility. Fortunately, iOS 15 has a new feature called Audio Graphs. This week we will learn how to build an audio representation for any SwiftUI view presenting a chart like a custom bar chart view or an image by using the accessibilityChartDescriptor view modifier." />
<link rel="canonical" href="http://localhost:4000/2021/09/29/audio-graphs-in-swiftui/" />
<meta property="og:url" content="http://localhost:4000/2021/09/29/audio-graphs-in-swiftui/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:image" content="http://localhost:4000/public/accessibility.jpeg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-29T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/public/accessibility.jpeg" />
<meta property="twitter:title" content="Audio graphs in SwiftUI" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/09/29/audio-graphs-in-swiftui/"},"url":"http://localhost:4000/2021/09/29/audio-graphs-in-swiftui/","image":"http://localhost:4000/public/accessibility.jpeg","author":{"@type":"Person","name":"Code4You"},"headline":"Audio graphs in SwiftUI","description":"Charts and graphs are one of the complicated things in terms of accessibility. Fortunately, iOS 15 has a new feature called Audio Graphs. This week we will learn how to build an audio representation for any SwiftUI view presenting a chart like a custom bar chart view or an image by using the accessibilityChartDescriptor view modifier.","dateModified":"2021-09-29T00:00:00+08:00","datePublished":"2021-09-29T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">Audio graphs in SwiftUI</h2>
  <time datetime="2021-09-29T00:00:00+08:00" class="post-date">29 Sep 2021</time>
  <p>Charts and graphs are one of the complicated things in terms of accessibility. Fortunately, iOS 15 has a new feature called Audio Graphs. This week we will learn how to build an audio representation for any SwiftUI view presenting a chart like a custom bar chart view or an image by using the <em>accessibilityChartDescriptor</em> view modifier.</p>

<p>Let’s start by building a simple bar chart view in SwiftUI that displays a set of data points using vertical bars.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">DataPoint</span><span class="p">:</span> <span class="kt">Identifiable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">label</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">Double</span>
    <span class="k">let</span> <span class="nv">color</span><span class="p">:</span> <span class="kt">Color</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we have the <em>DataPoint</em> struct that describes the bar in the bar chart view. It has id, label, numeric value, and color to fill. Next, we can define a bar chart view that accepts an array of <em>DataPoint</em> instances and displays them.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">BarChartView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">dataPoints</span><span class="p">:</span> <span class="p">[</span><span class="kt">DataPoint</span><span class="p">]</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">HStack</span><span class="p">(</span><span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">bottom</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">ForEach</span><span class="p">(</span><span class="n">dataPoints</span><span class="p">)</span> <span class="p">{</span> <span class="n">point</span> <span class="k">in</span>
                <span class="kt">VStack</span> <span class="p">{</span>
                    <span class="kt">RoundedRectangle</span><span class="p">(</span><span class="nv">cornerRadius</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="n">continuous</span><span class="p">)</span>
                        <span class="o">.</span><span class="nf">fill</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
                        <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">height</span><span class="p">:</span> <span class="n">point</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
                    <span class="kt">Text</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see in the example above, we have the <em>BarChartView</em> that receives an array of <em>DataPoint</em> instances and display them as rounded rectangles with different heights in the horizontal stack. I want to appreciate how easily we were able to build a bar chart view in SwiftUI. Let’s try to use our new <em>BarChartView</em> with sample data.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">dataPoints</span> <span class="o">=</span> <span class="p">[</span>
        <span class="kt">DataPoint</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nv">color</span><span class="p">:</span> <span class="o">.</span><span class="n">red</span><span class="p">),</span>
        <span class="kt">DataPoint</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"2"</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nv">color</span><span class="p">:</span> <span class="o">.</span><span class="n">blue</span><span class="p">),</span>
        <span class="kt">DataPoint</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"3"</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">color</span><span class="p">:</span> <span class="o">.</span><span class="n">red</span><span class="p">),</span>
        <span class="kt">DataPoint</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"4"</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nv">color</span><span class="p">:</span> <span class="o">.</span><span class="n">blue</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">BarChartView</span><span class="p">(</span><span class="nv">dataPoints</span><span class="p">:</span> <span class="n">dataPoints</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">accessibilityElement</span><span class="p">()</span>
            <span class="o">.</span><span class="nf">accessibilityLabel</span><span class="p">(</span><span class="s">"Chart representing some data"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we create a sample array of <em>DataPoint</em> instances and pass it to the <em>BarChartView</em>. We also make an accessibility element for the chart and disable its children’s accessibility information. To improve the accessibility experience for our chart view, we also added the accessibility label.</p>

<blockquote>
  <p>To learn about the basics of accessibility in SwiftUI, take a look at my <a href="/2019/09/10/accessibility-in-swiftui/">“Accessibility in SwiftUI”</a> post.</p>
</blockquote>

<p>Finally, we can start implementing the audio graph feature for our bar chart view. Audio graphs are available via the rotors menu. To use the rotor, rotate two fingers on your iOS device’s screen as if you’re turning a dial. VoiceOver will say the first rotor option. Keep rotating your fingers to hear more options. Lift your fingers to choose audio graphs. Then flick your finger up or down on the screen to navigate through it.</p>

<p>Audio graphs allow users to understand and interpret the chart data using audio components. VoiceOver plays sound with different pitches while moving through bars in your chart view. VoiceOver uses high pitches for more significant values and low pitches for small values. These pitches represent the data in your array.</p>

<blockquote>
  <p>To learn about the custom rotor navigation in SwiftUI, take a look at my <a href="/2021/09/14/accessibility-rotors-in-swiftui/">“Accessibility rotors in SwiftUI”</a> post.</p>
</blockquote>

<p>Now we can talk about implementing this feature in our <em>BarChartView</em>. First of all, we have to create a type conforming to the <em>AXChartDescriptorRepresentable</em> protocol. <em>AXChartDescriptorRepresentable</em> protocol has only one requirement that creates the instance of <em>AXChartDescriptor</em> type. The instance of the <em>AXChartDescriptor</em> type represents the data in our chart in the format that VoiceOver can understand and interact with.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">AXChartDescriptorRepresentable</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">makeChartDescriptor</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">AXChartDescriptor</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">xAxis</span> <span class="o">=</span> <span class="kt">AXCategoricalDataAxisDescriptor</span><span class="p">(</span>
            <span class="nv">title</span><span class="p">:</span> <span class="s">"Labels"</span><span class="p">,</span>
            <span class="nv">categoryOrder</span><span class="p">:</span> <span class="n">dataPoints</span><span class="o">.</span><span class="nf">map</span><span class="p">(\</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">let</span> <span class="nv">min</span> <span class="o">=</span> <span class="n">dataPoints</span><span class="o">.</span><span class="nf">map</span><span class="p">(\</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="nf">min</span><span class="p">()</span> <span class="p">??</span> <span class="mf">0.0</span>
        <span class="k">let</span> <span class="nv">max</span> <span class="o">=</span> <span class="n">dataPoints</span><span class="o">.</span><span class="nf">map</span><span class="p">(\</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="nf">max</span><span class="p">()</span> <span class="p">??</span> <span class="mf">0.0</span>

        <span class="k">let</span> <span class="nv">yAxis</span> <span class="o">=</span> <span class="kt">AXNumericDataAxisDescriptor</span><span class="p">(</span>
            <span class="nv">title</span><span class="p">:</span> <span class="s">"Values"</span><span class="p">,</span>
            <span class="nv">range</span><span class="p">:</span> <span class="n">min</span><span class="o">...</span><span class="n">max</span><span class="p">,</span>
            <span class="nv">gridlinePositions</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">)</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span> <span class="s">"</span><span class="se">\(</span><span class="n">value</span><span class="se">)</span><span class="s"> points"</span> <span class="p">}</span>

        <span class="k">let</span> <span class="nv">series</span> <span class="o">=</span> <span class="kt">AXDataSeriesDescriptor</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">""</span><span class="p">,</span>
            <span class="nv">isContinuous</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nv">dataPoints</span><span class="p">:</span> <span class="n">dataPoints</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span>
                <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="nv">$0</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="nv">$0</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="kt">AXChartDescriptor</span><span class="p">(</span>
            <span class="nv">title</span><span class="p">:</span> <span class="s">"Chart representing some data"</span><span class="p">,</span>
            <span class="nv">summary</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>
            <span class="nv">xAxis</span><span class="p">:</span> <span class="n">xAxis</span><span class="p">,</span>
            <span class="nv">yAxis</span><span class="p">:</span> <span class="n">yAxis</span><span class="p">,</span>
            <span class="nv">additionalAxes</span><span class="p">:</span> <span class="p">[],</span>
            <span class="nv">series</span><span class="p">:</span> <span class="p">[</span><span class="n">series</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>All we need to do is conforming to the <em>AXChartDescriptorRepresentable</em> protocol and add the <em>makeChartDescriptor</em> function that returns an instance of <em>AXChartDescriptor</em>.</p>

<p>First, we define the X and Y axes by using <em>AXCategoricalDataAxisDescriptor</em> and <em>AXNumericDataAxisDescriptor</em> types. We want to use string labels on the X-axis. That’s why we use the <em>AXCategoricalDataAxisDescriptor</em> type. In the case of a line chart, we will use the <em>AXNumericDataAxisDescriptor</em> for both axes.</p>

<p>Next, we use the <em>AXDataSeriesDescriptor</em> type to define points in our chart. There is the <em>isContinuous</em> parameter that allows us to define different chart styles. For example, it should be false for bar charts but true for line charts.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">dataPoints</span> <span class="o">=</span> <span class="p">[</span>
        <span class="kt">DataPoint</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nv">color</span><span class="p">:</span> <span class="o">.</span><span class="n">red</span><span class="p">),</span>
        <span class="kt">DataPoint</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"2"</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nv">color</span><span class="p">:</span> <span class="o">.</span><span class="n">blue</span><span class="p">),</span>
        <span class="kt">DataPoint</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"3"</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">color</span><span class="p">:</span> <span class="o">.</span><span class="n">red</span><span class="p">),</span>
        <span class="kt">DataPoint</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"4"</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nv">color</span><span class="p">:</span> <span class="o">.</span><span class="n">blue</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">BarChartView</span><span class="p">(</span><span class="nv">dataPoints</span><span class="p">:</span> <span class="n">dataPoints</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">accessibilityElement</span><span class="p">()</span>
            <span class="o">.</span><span class="nf">accessibilityLabel</span><span class="p">(</span><span class="s">"Chart representing some data"</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">accessibilityChartDescriptor</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As the last step, we use the <em>accessibilityChartDescriptor</em> view modifier to set the instance of <em>AXChartDescriptorRepresentable</em> protocol to describe our chart.</p>

<p>The audio graphs feature is a significant improvement for visually impaired users. The great thing about the audio graphs feature is that you can use it with any view you want, even with the image view. All you need is to create the instance of AXChartDescriptor type. I hope you enjoy the post. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this post. Thanks for reading, and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility rotors in SwiftUI" href="/2021/09/14/accessibility-rotors-in-swiftui/">
          Accessibility rotors in SwiftUI
          <small><time datetime="2021-09-14T00:00:00+08:00">14 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
