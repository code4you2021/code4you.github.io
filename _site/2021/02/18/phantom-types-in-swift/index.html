<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Phantom types in Swift | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Phantom types in Swift" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Not every language with a static type system has so strong type-safety like Swift. Swift features like phantom types, generic type extensions, enums with associated types create an excellent foundation. This week we will learn how to use phantom types to build type-safe APIs." />
<meta property="og:description" content="Not every language with a static type system has so strong type-safety like Swift. Swift features like phantom types, generic type extensions, enums with associated types create an excellent foundation. This week we will learn how to use phantom types to build type-safe APIs." />
<link rel="canonical" href="http://localhost:4000/2021/02/18/phantom-types-in-swift/" />
<meta property="og:url" content="http://localhost:4000/2021/02/18/phantom-types-in-swift/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:image" content="http://localhost:4000/public/phantom.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-02-18T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/public/phantom.jpg" />
<meta property="twitter:title" content="Phantom types in Swift" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/02/18/phantom-types-in-swift/"},"url":"http://localhost:4000/2021/02/18/phantom-types-in-swift/","image":"http://localhost:4000/public/phantom.jpg","author":{"@type":"Person","name":"Code4You"},"headline":"Phantom types in Swift","description":"Not every language with a static type system has so strong type-safety like Swift. Swift features like phantom types, generic type extensions, enums with associated types create an excellent foundation. This week we will learn how to use phantom types to build type-safe APIs.","dateModified":"2021-02-18T00:00:00+08:00","datePublished":"2021-02-18T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">Phantom types in Swift</h2>
  <time datetime="2021-02-18T00:00:00+08:00" class="post-date">18 Feb 2021</time>
  <p>Not every language with a static type system has so strong type-safety like Swift. Swift features like phantom types, generic type extensions, enums with associated types create an excellent foundation. This week we will learn how to use phantom types to build type-safe APIs.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<h4 id="basics">Basics</h4>
<p>A phantom type is a generic type that is declared but never used inside a type where it is declared. It is usually used as a generic constraint to build a more type-safe and robust API. Let’s take a look at the quick example.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">Identifier</span><span class="o">&lt;</span><span class="kt">Holder</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">Int</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the example above, we have the <em>Identifier</em> struct with a generic <em>Holder</em> type declared. As you can see, we don’t use the <em>Holder</em> type inside the <em>Identifier</em> type. That’s why it is called phantom type. Now let’s think about the benefits of using phantom types like this.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">User</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Identifier</span><span class="o">&lt;</span><span class="k">Self</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Product</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Identifier</span><span class="o">&lt;</span><span class="k">Self</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">product</span> <span class="o">=</span> <span class="kt">Product</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">1</span><span class="p">))</span>
<span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="kt">User</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">user</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">product</span><span class="o">.</span><span class="n">id</span>
</code></pre></div></div>

<p>We create <em>User</em> and <em>Product</em> types and use the previously created <em>Identifier</em> struct. We set the value of the identifier to 1 for the newly created user and product. But when we try to compare them, the Swift compiler fails with the error:</p>

<blockquote>
  <p>Binary operator ‘==’ cannot be applied to operands of type ‘<em>Identifier-User</em>’ and ‘<em>Identifier-Product</em>’.</p>
</blockquote>

<p>And that’s great because there is no reason to compare user and product identifiers. We can do it only accidentally. The Swift compiler doesn’t allow us to mix the identifiers between users and products because of phantom type and recognize them as entirely different types. Here is another example where the Swift compiler doesn’t allow us to mix identifiers.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">fetch</span><span class="p">(</span><span class="n">_</span> <span class="nv">product</span><span class="p">:</span> <span class="kt">Identifier</span><span class="o">&lt;</span><span class="kt">Product</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Product</span><span class="p">?</span> <span class="p">{</span>
    <span class="c1">// return product by id</span>
<span class="p">}</span>

<span class="nf">fetch</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>To learn more about the benefits of using phantom types, look at my <a href="/2021/02/10/building-type-safe-networking-in-swift/">“Building type-safe networking in Swift”</a> post.</p>
</blockquote>

<h4 id="type-safety-in-healthkit">Type safety in HealthKit</h4>
<p>We learned the basics of phantom types. Now we can move to more advanced examples. I built a couple of health-oriented apps that use HealthKit to store and query health data from the Apple Watch. Let’s look at the typical code that I use to fetch data from the Apple Health app.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">HealthKit</span>

<span class="k">let</span> <span class="nv">store</span> <span class="o">=</span> <span class="kt">HKHealthStore</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">bodyMass</span> <span class="o">=</span> <span class="kt">HKQuantityType</span><span class="o">.</span><span class="nf">quantityType</span><span class="p">(</span>
    <span class="nv">forIdentifier</span><span class="p">:</span> <span class="kt">HKQuantityTypeIdentifier</span><span class="o">.</span><span class="n">bodyMass</span>
<span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">query</span> <span class="o">=</span> <span class="kt">HKStatisticsQuery</span><span class="p">(</span>
    <span class="nv">quantityType</span><span class="p">:</span> <span class="n">bodyMass</span><span class="p">,</span>
    <span class="nv">quantitySamplePredicate</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>
    <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">discreteAverage</span>
<span class="p">)</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">statistics</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">average</span> <span class="o">=</span> <span class="n">statistics</span><span class="p">?</span><span class="o">.</span><span class="nf">averageQuantity</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">mass</span> <span class="o">=</span> <span class="n">average</span><span class="p">?</span><span class="o">.</span><span class="nf">doubleValue</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="nf">meter</span><span class="p">())</span>
<span class="p">}</span>

<span class="n">store</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</code></pre></div></div>

<p>In the example above, we create a query to fetch user’s weight from the Apple Health app. In the completion handler, we try to get the average and convert it to meters. As you can guess, it is impossible to convert body mass to meters, and the app will crash here. We will try to solve the issue by introducing phantom type to build more type-safe API.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="kt">Distance</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">mile</span>
    <span class="k">case</span> <span class="n">meter</span>
<span class="p">}</span>

<span class="kd">enum</span> <span class="kt">Mass</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">pound</span>
    <span class="k">case</span> <span class="n">gram</span>
    <span class="k">case</span> <span class="n">ounce</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Statistics</span><span class="o">&lt;</span><span class="kt">Unit</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">Double</span>
<span class="p">}</span>


<span class="kd">extension</span> <span class="kt">Statistics</span> <span class="k">where</span> <span class="kt">Unit</span> <span class="o">==</span> <span class="kt">Mass</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">convert</span><span class="p">(</span><span class="n">to</span> <span class="nv">unit</span><span class="p">:</span> <span class="kt">Mass</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Double</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Statistics</span> <span class="k">where</span> <span class="kt">Unit</span> <span class="o">==</span> <span class="kt">Distance</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">convert</span><span class="p">(</span><span class="n">to</span> <span class="nv">unit</span><span class="p">:</span> <span class="kt">Distance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Double</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">weight</span> <span class="o">=</span> <span class="kt">Statistics</span><span class="o">&lt;</span><span class="kt">Mass</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">75</span><span class="p">)</span>
<span class="n">weight</span><span class="o">.</span><span class="nf">convert</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">Distance</span><span class="o">.</span><span class="n">meter</span><span class="p">)</span>
</code></pre></div></div>

<p>Here is a possible solution for the HealthKit framework that uses phantom type to improve API safety. We introduce <em>Mass</em> and <em>Distance</em> enums to have distinct units. And as soon you try to convert mass into the distance, the Swift compiler stops you with a great error message:</p>

<blockquote>
  <p>Cannot convert the value of type ‘<em>Distance</em>’ to expected argument type ‘<em>Mass</em>’</p>
</blockquote>

<h4 id="conclusion">Conclusion</h4>
<p>Today we learned phantom types, one of my favorite features of the Swift language. It looks like there are a lot of possible applications for phantom types. Feel free to share with me how you make your API more type-safe by using phantom types. I hope you enjoy the post. Follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this article. Thanks for reading, and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
