<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Lazy navigation in SwiftUI | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Lazy navigation in SwiftUI" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Most of our apps are more than just a single screen app. We use the navigation to connect different screens inside the app. SwiftUI provides us NavigationLink struct that we can use to link views. This week we will learn how to use NavigationLink more efficiently than before by making it lazy." />
<meta property="og:description" content="Most of our apps are more than just a single screen app. We use the navigation to connect different screens inside the app. SwiftUI provides us NavigationLink struct that we can use to link views. This week we will learn how to use NavigationLink more efficiently than before by making it lazy." />
<link rel="canonical" href="http://localhost:4000/2021/01/27/lazy-navigation-in-swiftui/" />
<meta property="og:url" content="http://localhost:4000/2021/01/27/lazy-navigation-in-swiftui/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:image" content="http://localhost:4000/public/lazy.PNG" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-27T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/public/lazy.PNG" />
<meta property="twitter:title" content="Lazy navigation in SwiftUI" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/01/27/lazy-navigation-in-swiftui/"},"url":"http://localhost:4000/2021/01/27/lazy-navigation-in-swiftui/","image":"http://localhost:4000/public/lazy.PNG","author":{"@type":"Person","name":"Code4You"},"headline":"Lazy navigation in SwiftUI","description":"Most of our apps are more than just a single screen app. We use the navigation to connect different screens inside the app. SwiftUI provides us NavigationLink struct that we can use to link views. This week we will learn how to use NavigationLink more efficiently than before by making it lazy.","dateModified":"2021-01-27T00:00:00+08:00","datePublished":"2021-01-27T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">Lazy navigation in SwiftUI</h2>
  <time datetime="2021-01-27T00:00:00+08:00" class="post-date">27 Jan 2021</time>
  <p>Most of our apps are more than just a single screen app. We use the navigation to connect different screens inside the app. SwiftUI provides us <em>NavigationLink</em> struct that we can use to link views. This week we will learn how to use <em>NavigationLink</em> more efficiently than before by making it lazy.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<p>Usually, we have to set up navigation links by providing both source and destination views. In some cases, it might be a bottleneck for your view. I have a calendar screen in my app that displays the summary for every day during the last two years. Every date in the calendar is clickable and linked to the details screen using <em>NavigationLink</em>.</p>

<blockquote>
  <p>To learn more about the basics of <em>NavigationLink</em>, take a look at my <a href="/2019/07/17/navigation-in-swiftui/">“Navigation in SwiftUI”</a> post.</p>
</blockquote>

<p>OK, my calendar screen shows the information for every date during the last two years. It means I have to construct 730 <em>NavigationLinks</em> plus destination views for every date. This makes 1460 views. Assume that the state in this view changes and SwiftUI has to recalculate all these views. It is a lot of work to do.</p>

<p><img src="/public/lazy.PNG" alt="calendar" /></p>

<p>In this case, I don’t want to create navigation links when the calendar view is loaded. I would like to have only one <em>NavigationLink</em>, which activates as soon as the user selects the calendar date. Let’s take a look at the API that I want to achieve.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>

<span class="kd">struct</span> <span class="kt">CalendarContainerView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">interval</span><span class="p">:</span> <span class="kt">DateInterval</span>

    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">selectedDate</span><span class="p">:</span> <span class="kt">Date</span><span class="p">?</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">ScrollView</span><span class="p">(</span><span class="o">.</span><span class="n">vertical</span><span class="p">,</span> <span class="nv">showsIndicators</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">CalendarView</span><span class="p">(</span><span class="nv">interval</span><span class="p">:</span> <span class="n">interval</span><span class="p">,</span> <span class="nv">onHeaderAppear</span><span class="p">:</span> <span class="n">fetch</span><span class="p">)</span> <span class="p">{</span> <span class="n">date</span> <span class="k">in</span>
                <span class="kt">DateView</span><span class="p">(</span><span class="nv">date</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// Some content here</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">navigationBarTitle</span><span class="p">(</span><span class="s">"calendar"</span><span class="p">,</span> <span class="nv">displayMode</span><span class="p">:</span> <span class="o">.</span><span class="n">inline</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">navigate</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="err">$</span><span class="n">selectedDate</span><span class="p">,</span> <span class="nv">destination</span><span class="p">:</span> <span class="n">makeDestination</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see in the example above, we have the <em>navigate</em> view modifier that accepts binding and the closure to build the destination view. First, we need to bind over the optional value to activate <em>NavigationLink</em> only when a value is available. Next, we should define a closure accepting a value and annotate it with <em>@ViewBuilder</em>. Let’s start by creating a <em>NavigationLink</em> extension to add a new initializer that supports our flow.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>

<span class="kd">extension</span> <span class="kt">NavigationLink</span> <span class="k">where</span> <span class="kt">Label</span> <span class="o">==</span> <span class="kt">EmptyView</span> <span class="p">{</span>
    <span class="kd">init</span><span class="p">?</span><span class="o">&lt;</span><span class="kt">Value</span><span class="o">&gt;</span><span class="p">(</span>
        <span class="n">_</span> <span class="nv">binding</span><span class="p">:</span> <span class="kt">Binding</span><span class="o">&lt;</span><span class="kt">Value</span><span class="p">?</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="kd">@ViewBuilder</span> <span class="nv">destination</span><span class="p">:</span> <span class="p">(</span><span class="kt">Value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Destination</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="n">binding</span><span class="o">.</span><span class="n">wrappedValue</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">isActive</span> <span class="o">=</span> <span class="kt">Binding</span><span class="p">(</span>
            <span class="nv">get</span><span class="p">:</span> <span class="p">{</span> <span class="kc">true</span> <span class="p">},</span>
            <span class="nv">set</span><span class="p">:</span> <span class="p">{</span> <span class="n">newValue</span> <span class="k">in</span> <span class="k">if</span> <span class="o">!</span><span class="n">newValue</span> <span class="p">{</span> <span class="n">binding</span><span class="o">.</span><span class="n">wrappedValue</span> <span class="o">=</span> <span class="kc">nil</span> <span class="p">}</span> <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">destination</span><span class="p">:</span> <span class="nf">destination</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="nv">isActive</span><span class="p">:</span> <span class="n">isActive</span><span class="p">,</span> <span class="nv">label</span><span class="p">:</span> <span class="kt">EmptyView</span><span class="o">.</span><span class="kd">init</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>To learn more about benefits of <em>@ViewBuilder</em>, take a look at <a href="/2019/12/18/the-power-of-viewbuilder-in-swiftui/">“The power of @ViewBuilder in SwiftUI”</a> post.</p>
</blockquote>

<p>We create the failable initializer for <em>NavigationLink</em>, where Label is <em>EmptyView</em>. It means we will hide <em>NavigationLink</em> from the screen, but it still will be there, and we can activate it as soon as our binding provides a value. Now we can create an extension on the <em>View</em> protocol to use the new API nicely.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@ViewBuilder</span>
    <span class="kd">func</span> <span class="n">navigate</span><span class="o">&lt;</span><span class="kt">Value</span><span class="p">,</span> <span class="kt">Destination</span><span class="p">:</span> <span class="kt">View</span><span class="o">&gt;</span><span class="p">(</span>
        <span class="n">using</span> <span class="nv">binding</span><span class="p">:</span> <span class="kt">Binding</span><span class="o">&lt;</span><span class="kt">Value</span><span class="p">?</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="kd">@ViewBuilder</span> <span class="nv">destination</span><span class="p">:</span> <span class="p">(</span><span class="kt">Value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Destination</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="nf">background</span><span class="p">(</span><span class="kt">NavigationLink</span><span class="p">(</span><span class="n">binding</span><span class="p">,</span> <span class="nv">destination</span><span class="p">:</span> <span class="n">destination</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we define an extension on the <em>View</em> protocol that allows us to bind a value to the destination view. As you remember, we use <em>EmptyView</em> as <em>NavigationLink</em> label, and it allows us to set the <em>NavigationLink</em> as the view background invisibly. Now let’s take a look at how we can use the new API in our apps.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>

<span class="kd">struct</span> <span class="kt">CalendarContainerView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">interval</span><span class="p">:</span> <span class="kt">DateInterval</span>

    <span class="kd">@EnvironmentObject</span> <span class="k">var</span> <span class="nv">store</span><span class="p">:</span> <span class="kt">Store</span><span class="o">&lt;</span><span class="kt">CalendarState</span><span class="p">,</span> <span class="kt">CalendarAction</span><span class="o">&gt;</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">selectedDate</span><span class="p">:</span> <span class="kt">Date</span><span class="p">?</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">ScrollView</span><span class="p">(</span><span class="o">.</span><span class="n">vertical</span><span class="p">,</span> <span class="nv">showsIndicators</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">CalendarView</span><span class="p">(</span><span class="nv">interval</span><span class="p">:</span> <span class="n">interval</span><span class="p">,</span> <span class="nv">onHeaderAppear</span><span class="p">:</span> <span class="n">fetch</span><span class="p">)</span> <span class="p">{</span> <span class="n">date</span> <span class="k">in</span>
                <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span> <span class="k">self</span><span class="o">.</span><span class="n">selectedDate</span> <span class="o">=</span> <span class="n">date</span> <span class="p">})</span> <span class="p">{</span>
                    <span class="kt">DateView</span><span class="p">(</span><span class="nv">date</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// Some content here</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">navigationBarTitle</span><span class="p">(</span><span class="s">"calendar"</span><span class="p">,</span> <span class="nv">displayMode</span><span class="p">:</span> <span class="o">.</span><span class="n">inline</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">navigate</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="err">$</span><span class="n">selectedDate</span><span class="p">,</span> <span class="nv">destination</span><span class="p">:</span> <span class="n">makeDestination</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">@ViewBuilder</span>
    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">makeDestination</span><span class="p">(</span><span class="k">for</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">Date</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="c1">// create and configure destination view here</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see, it decreases the number of views that SwiftUI should recalculate on state changes. The second benefit is the lazy nature that allows us to move decision flow to a later date. So you can dynamically decide which view should be the destination depending on the value you have in the binding.</p>

<p>I would like to see the approach we use in this post as a part of SwiftUI next year. I hope you enjoy the post. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this article. Thanks for reading, and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
