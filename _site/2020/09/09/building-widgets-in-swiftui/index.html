<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Building widgets in SwiftUI | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Building widgets in SwiftUI" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This week I want to talk to you about home-screen widgets in iOS 14. I’ve built several widget collections for my apps, and it is a perfect time to share with you that experience. Today we will learn all about building and updating widgets with SwiftUI." />
<meta property="og:description" content="This week I want to talk to you about home-screen widgets in iOS 14. I’ve built several widget collections for my apps, and it is a perfect time to share with you that experience. Today we will learn all about building and updating widgets with SwiftUI." />
<link rel="canonical" href="http://localhost:4000/2020/09/09/building-widgets-in-swiftui/" />
<meta property="og:url" content="http://localhost:4000/2020/09/09/building-widgets-in-swiftui/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:image" content="http://localhost:4000/public/widget.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-09T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/public/widget.jpg" />
<meta property="twitter:title" content="Building widgets in SwiftUI" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/09/09/building-widgets-in-swiftui/"},"url":"http://localhost:4000/2020/09/09/building-widgets-in-swiftui/","image":"http://localhost:4000/public/widget.jpg","author":{"@type":"Person","name":"Code4You"},"headline":"Building widgets in SwiftUI","description":"This week I want to talk to you about home-screen widgets in iOS 14. I’ve built several widget collections for my apps, and it is a perfect time to share with you that experience. Today we will learn all about building and updating widgets with SwiftUI.","dateModified":"2020-09-09T00:00:00+08:00","datePublished":"2020-09-09T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">Building widgets in SwiftUI</h2>
  <time datetime="2020-09-09T00:00:00+08:00" class="post-date">09 Sep 2020</time>
  <p>This week I want to talk to you about home-screen widgets in iOS 14. I’ve built several widget collections for my apps, and it is a perfect time to share with you that experience. Today we will learn all about building and updating widgets with SwiftUI.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<h4 id="basics">Basics</h4>
<p>Widgets display relevant, glanceable content, letting users quickly get to your app for more details. Your app can provide multiple kinds of widgets, allowing users to focus on essential information. They can add multiple copies of the same widget, tailoring each one to their unique needs and layout. I think it is an excellent definition for widgets, thanks to Apple.</p>

<p>Let’s start by adding a widget extension to your app using the Xcode menu: <em>File -&gt; New -&gt; Target -&gt; Widget Extension</em>. Xcode creates a widget from the template. It might look like this.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@main</span>
<span class="kd">struct</span> <span class="kt">MyWidget</span><span class="p">:</span> <span class="kt">Widget</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">kind</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"Widget"</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">WidgetConfiguration</span> <span class="p">{</span>
        <span class="kt">StaticConfiguration</span><span class="p">(</span><span class="nv">kind</span><span class="p">:</span> <span class="n">kind</span><span class="p">,</span> <span class="nv">provider</span><span class="p">:</span> <span class="kt">Provider</span><span class="p">())</span> <span class="p">{</span> <span class="n">entry</span> <span class="k">in</span>
            <span class="kt">WidgetEntryView</span><span class="p">(</span><span class="nv">entry</span><span class="p">:</span> <span class="n">entry</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">supportedFamilies</span><span class="p">([</span><span class="o">.</span><span class="n">systemSmall</span><span class="p">,</span> <span class="o">.</span><span class="n">systemMedium</span><span class="p">,</span> <span class="o">.</span><span class="n">systemLarge</span><span class="p">])</span>
        <span class="o">.</span><span class="nf">configurationDisplayName</span><span class="p">(</span><span class="s">"My Widget"</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">description</span><span class="p">(</span><span class="s">"This is an example widget."</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see, we develop a widget by creating a struct that conforms to the <em>Widget</em> protocol. The only requirement of the <em>Widget</em> protocol is body property that should return an instance of <em>WidgetConfiguration</em>. SwiftUI provides us two structs that conform to <em>WidgetConfiguration</em>: <em>StaticConfiguration</em> and <em>IntentConfiguration</em>.</p>

<p>We can use <em>IntentConfiguration</em> to provide user-configurable options for our widget. In this post, we will talk about <em>StaticConfiguration</em>. <em>StaticConfiguration</em> allows us to register a widget configured by the developer that time-to-time updates its data.</p>

<p><em>StaticConfiguration</em> needs three parameters. Let’s take a look at them one-by-one.</p>

<ol>
  <li>Kind is a string that identifies the type of widget. Your app might have multiple widgets. In this case, a kind identifier allows you to update widgets of a particular kind.</li>
  <li>The provider is a type conforming to <em>Provider</em> protocol and used by the system to fetch widget data.</li>
  <li>View builder closure that describes the SwiftUI view for displaying widget data.</li>
</ol>

<p>You can also attach a few modifiers to your widget configuration for setting supported widget families or providing description and name.</p>

<blockquote>
  <p>To learn more about <em>@main</em> and new App lifecycle in SwiftUI, take a look at my <a href="https://swiftwithmajid.com/2020/08/19/managing-app-in-swiftui/">“Managing app in SwiftUI”</a> post.</p>
</blockquote>

<h4 id="provider">Provider</h4>
<p>The system will call your provider to fetch new data. Let’s look at the provider example that I use in my <a href="https://cardiobot.swiftwithmajid.com">CardioBot</a> app to display daily heart points.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="kd">class</span> <span class="kt">HeartPointsProvider</span><span class="p">:</span> <span class="kt">TimelineProvider</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">typealias</span> <span class="kt">Entry</span> <span class="o">=</span> <span class="kt">HeartPointsViewModel</span>

    <span class="k">let</span> <span class="nv">service</span> <span class="o">=</span> <span class="kt">HealthService</span><span class="p">()</span>
    <span class="k">var</span> <span class="nv">snapshotCancellable</span><span class="p">:</span> <span class="kt">AnyCancellable</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">timelineCancellable</span><span class="p">:</span> <span class="kt">AnyCancellable</span><span class="p">?</span>

    <span class="kd">private</span> <span class="k">var</span> <span class="nv">entryPublisher</span><span class="p">:</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Entry</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span> <span class="cm">/*.... */</span> <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">placeholder</span><span class="p">(</span><span class="k">in</span> <span class="nv">with</span><span class="p">:</span> <span class="kt">Context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">HeartPointsViewModel</span> <span class="p">{</span>
        <span class="kt">HeartPointsViewModel</span><span class="p">(</span>
            <span class="nv">heartRates</span><span class="p">:</span> <span class="p">[</span><span class="kt">HeartRate</span><span class="p">(</span><span class="nv">bpm</span><span class="p">:</span> <span class="mi">130</span><span class="p">)],</span>
            <span class="nv">age</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span>
            <span class="nv">goal</span><span class="p">:</span> <span class="mi">20</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">getSnapshot</span><span class="p">(</span><span class="k">in</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">Context</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">HeartPointsViewModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">snapshotCancellable</span> <span class="o">=</span> <span class="n">entryPublisher</span>
            <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveValue</span><span class="p">:</span> <span class="n">completion</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">getTimeline</span><span class="p">(</span><span class="k">in</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">Context</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Timeline</span><span class="o">&lt;</span><span class="kt">HeartPointsViewModel</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">timelineCancellable</span> <span class="o">=</span> <span class="n">entryPublisher</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">Timeline</span><span class="p">(</span><span class="nv">entries</span><span class="p">:</span> <span class="p">[</span><span class="nv">$0</span><span class="p">],</span> <span class="nv">policy</span><span class="p">:</span> <span class="o">.</span><span class="n">atEnd</span><span class="p">)</span> <span class="p">}</span>
            <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveValue</span><span class="p">:</span> <span class="n">completion</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We start by defining type alias for the associated type of <em>Provider</em> protocol. <em>Provider</em> protocol uses the <em>Entry</em> type to describe an item that should be displayed in the widget. Entry must conform to the <em>TimelineEntry</em> protocol that requires only date property.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">HeartPointsViewModel</span><span class="p">:</span> <span class="kt">TimelineEntry</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">Date</span> <span class="p">{</span>
        <span class="n">heartRates</span><span class="o">.</span><span class="n">last</span><span class="p">?</span><span class="o">.</span><span class="n">interval</span><span class="o">.</span><span class="n">end</span> <span class="p">??</span> <span class="kt">Date</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>There are three required functions in the protocol:</p>
<ol>
  <li><em>placeholder</em> function is used by the system to generate a template view in the widget gallery. You can provide mock data here that will look nice in the gallery.</li>
  <li><em>getSnapshot</em> function is used when the widget is in a transient state. Call the completion handler as soon as possible to provide data for your widget.</li>
  <li><em>getTimeline</em> function is used by the system to fetch current and future entries for your widget.</li>
</ol>

<p><em>getTimeline</em> is the most exciting function here. It allows us to return a timeline of entries for our widget and define a date for the next update.</p>

<h4 id="widget-view">Widget view</h4>
<p>Usually, we create a SwiftUI view that accepts an entry and displays it. Then we can easily use it inside a view builder closure in widget configuration. We can use <em>widgetFamily</em> environment value to understand the current widget configuration’s size and present different views.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">HeartPointsEntryView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@Environment</span><span class="p">(\</span><span class="o">.</span><span class="n">widgetFamily</span><span class="p">)</span> <span class="k">var</span> <span class="nv">size</span>
    <span class="k">let</span> <span class="nv">entry</span><span class="p">:</span> <span class="kt">HeartPointsViewModel</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">size</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">systemSmall</span><span class="p">:</span>
            <span class="kt">SmallWidgetEntryView</span><span class="p">(</span><span class="nv">viewModel</span><span class="p">:</span> <span class="n">entry</span><span class="p">)</span><span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">systemMedium</span><span class="p">:</span>
            <span class="kt">HStack</span><span class="p">(</span><span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">bottom</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">SmallWidgetEntryView</span><span class="p">(</span><span class="nv">viewModel</span><span class="p">:</span> <span class="n">entry</span><span class="p">)</span>
                <span class="kt">HeartPointsChartView</span><span class="p">(</span><span class="nv">viewModel</span><span class="p">:</span> <span class="n">entry</span><span class="p">,</span> <span class="nv">labelCount</span><span class="p">:</span> <span class="mi">6</span><span class="p">)</span>
            <span class="p">}</span><span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">systemLarge</span><span class="p">:</span>
            <span class="kt">VStack</span><span class="p">(</span><span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">leading</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">HeartPointsView</span><span class="p">(</span><span class="nv">viewModel</span><span class="p">:</span> <span class="n">entry</span><span class="p">,</span> <span class="nv">showLabel</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
                <span class="kt">HeartPointsChartView</span><span class="p">(</span><span class="nv">viewModel</span><span class="p">:</span> <span class="n">entry</span><span class="p">)</span>
            <span class="p">}</span><span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
        <span class="kd">@unknown</span> <span class="k">default</span><span class="p">:</span>
            <span class="kt">SmallWidgetEntryView</span><span class="p">(</span><span class="nv">viewModel</span><span class="p">:</span> <span class="n">entry</span><span class="p">)</span><span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="widget-updates">Widget updates</h4>
<p>The system will try to predict the best time to perform widget updates using providers. But you can always ask to update your widgets using <em>WidgetCenter</em>.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">WidgetCenter</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">reloadAllTimelines</span><span class="p">()</span>
<span class="kt">WidgetCenter</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">reloadTimelines</span><span class="p">(</span><span class="nv">ofKind</span><span class="p">:</span> <span class="s">"heartRateWidget"</span><span class="p">)</span>
</code></pre></div></div>

<p>As you can see, there are two options for updating your widgets. You can update all of your widgets or update only the particular kind.</p>

<h4 id="widget-bundle">Widget bundle</h4>
<p>As we know, your app might have more than one widget. In this case, we have to create a widget bundle.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@main</span>
<span class="kd">struct</span> <span class="kt">CardioBotWidgets</span><span class="p">:</span> <span class="kt">WidgetBundle</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">Widget</span> <span class="p">{</span>
        <span class="kt">HeartPointsWidget</span><span class="p">()</span>
        <span class="kt">HeartRateSummaryWidget</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Remember to remove <em>@main</em> from your widget definitions and add it only to your widget bundle.</p>

<h4 id="conclusion">Conclusion</h4>
<p>Today we learned about another feature that is released during WWDC20. Remember that widgets are available on macOS in the notification center also. I hope you enjoy the post. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this article. Thanks for reading, and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
