<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Managing scenes in SwiftUI | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Managing scenes in SwiftUI" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This week we will continue the series of posts about the app and scene lifecycle in SwiftUI. Today we will concentrate on scene management and the features that the new Scene protocol provides us to replace the old SceneDelegate." />
<meta property="og:description" content="This week we will continue the series of posts about the app and scene lifecycle in SwiftUI. Today we will concentrate on scene management and the features that the new Scene protocol provides us to replace the old SceneDelegate." />
<link rel="canonical" href="http://localhost:4000/2020/08/26/managing-scenes-in-swiftui/" />
<meta property="og:url" content="http://localhost:4000/2020/08/26/managing-scenes-in-swiftui/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:image" content="http://localhost:4000/public/wwdc20.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-26T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/public/wwdc20.jpg" />
<meta property="twitter:title" content="Managing scenes in SwiftUI" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/08/26/managing-scenes-in-swiftui/"},"url":"http://localhost:4000/2020/08/26/managing-scenes-in-swiftui/","image":"http://localhost:4000/public/wwdc20.jpg","author":{"@type":"Person","name":"Code4You"},"headline":"Managing scenes in SwiftUI","description":"This week we will continue the series of posts about the app and scene lifecycle in SwiftUI. Today we will concentrate on scene management and the features that the new Scene protocol provides us to replace the old SceneDelegate.","dateModified":"2020-08-26T00:00:00+08:00","datePublished":"2020-08-26T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">Managing scenes in SwiftUI</h2>
  <time datetime="2020-08-26T00:00:00+08:00" class="post-date">26 Aug 2020</time>
  <p>This week we will continue the series of posts about the app and scene lifecycle in SwiftUI. Today we will concentrate on scene management and the features that the new <em>Scene</em> protocol provides us to replace the old <em>SceneDelegate</em>.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<h4 id="basics">Basics</h4>
<p>The scene is a part of an app’s user interface with a lifecycle managed by the system. The system will decide how to present it to a user depending on the running platform. For example, it might be a full-screen window on iOS and watchOS, or it can use the part of the screen to render user interface on macOS and iPadOS. Let’s start with a small example.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@main</span>
<span class="kd">struct</span> <span class="kt">MyApp</span><span class="p">:</span> <span class="kt">App</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">Scene</span> <span class="p">{</span>
        <span class="kt">WindowGroup</span> <span class="p">{</span>
            <span class="kt">Text</span><span class="p">(</span><span class="s">"Hello World!"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see in the example above, we use the new app lifecycle API to build our app. The only requirement of <em>App</em> protocol is the body property that should return the instance of <em>Scene</em> protocol.</p>

<blockquote>
  <p>If you are not familiar with the new App lifecycle API in SwiftUI, I highly recommend you to take a look at my <a href="/2020/08/19/managing-app-in-swiftui/">“Managing app in SwiftUI”</a> post.</p>
</blockquote>

<p>Here we use <em>WindowGroup</em>. It is one of the primitive scene types that SwiftUI gives us out of the box. <em>WindowGroup</em> is a scene that presents a group of identically structured windows. It allows the user to create as many windows with the same user interface as needed and provide functionality for grouping them into tabs on macOS. On iOS and watchOS, <em>WindowGroup</em> consumes the entire screen to render its content.</p>

<p><em>WindowGroup</em> is the scene type that you will mostly use. But there are other scene types like <em>DocumentGroup</em> and <em>Settings</em> that you can use to build document-based apps or to provide settings window on macOS.</p>

<blockquote>
  <p>To learn more about other types of scenes in SwiftUI, take a look at my <a href="/2020/06/23/what-is-new-in-swiftui/">“What’s new in SwiftUI”</a> post.</p>
</blockquote>

<h4 id="scene-phase">Scene phase</h4>
<p>There are several scene callbacks like <em>sceneDidBecomeActive</em> and <em>sceneWillEnterForeground</em> that we used to handle in <em>SceneDelegate</em>. SwiftUI gives us a new solution to achieve the same result in a new way. Scenes provide us the <em>onChange</em> modifier and scene phase environment value that we can use to handle scene state changes. Let’s take a look at the example.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>

<span class="kd">@main</span>
<span class="kd">struct</span> <span class="kt">CardioBotApp</span><span class="p">:</span> <span class="kt">App</span> <span class="p">{</span>
    <span class="kd">@Environment</span><span class="p">(\</span><span class="o">.</span><span class="n">scenePhase</span><span class="p">)</span> <span class="k">var</span> <span class="nv">scenePhase</span>
    <span class="kd">@StateObject</span> <span class="k">var</span> <span class="nv">store</span> <span class="o">=</span> <span class="kt">Store</span><span class="p">(</span>
        <span class="nv">initialState</span><span class="p">:</span> <span class="kt">AppState</span><span class="p">(),</span>
        <span class="nv">reducer</span><span class="p">:</span> <span class="n">appReducer</span><span class="p">,</span>
        <span class="nv">environment</span><span class="p">:</span> <span class="o">.</span><span class="n">live</span>
    <span class="p">)</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">Scene</span> <span class="p">{</span>
        <span class="kt">WindowGroup</span> <span class="p">{</span>
            <span class="kt">RootView</span><span class="p">()</span><span class="o">.</span><span class="nf">environmentObject</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">onChange</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">scenePhase</span><span class="p">)</span> <span class="p">{</span> <span class="n">phase</span> <span class="k">in</span>    
            <span class="k">switch</span> <span class="n">phase</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">background</span><span class="p">:</span>
                <span class="n">store</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="nf">notifications</span><span class="p">(</span><span class="o">.</span><span class="n">startObservers</span><span class="p">))</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">active</span><span class="p">:</span>
                <span class="n">store</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">fetch</span><span class="p">)</span>
            <span class="k">default</span><span class="p">:</span> <span class="k">break</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>SwiftUI will run the closure that you pass to <em>onChange</em> modifier whenever the value of scene phase changes.</p>

<h4 id="custom-scenes">Custom scenes</h4>
<p>Composition is my favorite thing about SwiftUI. You can create many small views and compose them together into a complex picture. The same rule applies to scenes. You can create your custom scene that uses primitive scenes provided by SwiftUI.</p>

<p>I work on the app that supports both watchOS and iOS. It shares the codebase between two platforms, but it has different feature sets on iOS and watchOS. Let’s start with iOS.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">MainScene</span><span class="p">:</span> <span class="kt">Scene</span> <span class="p">{</span>
    <span class="kd">@Environment</span><span class="p">(\</span><span class="o">.</span><span class="n">scenePhase</span><span class="p">)</span> <span class="k">var</span> <span class="nv">scenePhase</span>
    <span class="kd">@ObservedObject</span> <span class="k">var</span> <span class="nv">store</span><span class="p">:</span> <span class="kt">Store</span><span class="o">&lt;</span><span class="kt">AppState</span><span class="p">,</span> <span class="kt">AppAction</span><span class="o">&gt;</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">Scene</span> <span class="p">{</span>
        <span class="kt">WindowGroup</span> <span class="p">{</span>
            <span class="kt">RootView</span><span class="p">()</span><span class="o">.</span><span class="nf">environmentObject</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
        <span class="p">}</span><span class="o">.</span><span class="nf">onChange</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">scenePhase</span><span class="p">)</span> <span class="p">{</span> <span class="n">scenePhase</span> <span class="k">in</span>
            <span class="k">switch</span> <span class="n">scenePhase</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">active</span><span class="p">:</span>
                <span class="n">store</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">fetch</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">background</span><span class="p">:</span>
                <span class="n">store</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">startObservers</span><span class="p">)</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We create a custom scene type that conforms to <em>Scene</em> protocol. The only requirement is the body property that should also return an instance of scene protocol. My app is derived by a global store that I ask to fetch data when the scene becomes active. I even start observers when the scene enters the background.</p>

<p>On the other hand, my watchOS app doesn’t have background observers. It also provides an additional scenes for handling dynamic notifications in SwiftUI. That’s why I decided to create another scene for the watchOS app.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">WatchAppScene</span><span class="p">:</span> <span class="kt">Scene</span> <span class="p">{</span>
    <span class="kd">@Environment</span><span class="p">(\</span><span class="o">.</span><span class="n">scenePhase</span><span class="p">)</span> <span class="k">var</span> <span class="nv">scenePhase</span>
    <span class="kd">@ObservedObject</span> <span class="k">var</span> <span class="nv">store</span><span class="p">:</span> <span class="kt">Store</span><span class="o">&lt;</span><span class="kt">AppState</span><span class="p">,</span> <span class="kt">AppAction</span><span class="o">&gt;</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">Scene</span> <span class="p">{</span>
        <span class="kt">WindowGroup</span> <span class="p">{</span>
            <span class="kt">RootView</span><span class="p">()</span><span class="o">.</span><span class="nf">environmentObject</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
        <span class="p">}</span><span class="o">.</span><span class="nf">onChange</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">scenePhase</span><span class="p">)</span> <span class="p">{</span> <span class="n">scenePhase</span> <span class="k">in</span>
            <span class="k">if</span> <span class="n">scenePhase</span> <span class="o">==</span> <span class="o">.</span><span class="n">active</span> <span class="p">{</span>
                <span class="n">store</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">fetch</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kt">WKNotificationScene</span><span class="p">(</span><span class="nv">controller</span><span class="p">:</span> <span class="kt">DailyReportController</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">category</span><span class="p">:</span> <span class="s">"dailyReport"</span><span class="p">)</span>
        <span class="kt">WKNotificationScene</span><span class="p">(</span><span class="nv">controller</span><span class="p">:</span> <span class="kt">WorkoutController</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">category</span><span class="p">:</span> <span class="s">"workoutReport"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see, my watchOS app is slightly different. Now let’s take a look at how we can compose our custom scene types in one app.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@main</span>
<span class="kd">struct</span> <span class="kt">CardioApp</span><span class="p">:</span> <span class="kt">App</span> <span class="p">{</span>
    <span class="kd">@StateObject</span> <span class="k">var</span> <span class="nv">store</span> <span class="o">=</span> <span class="kt">Store</span><span class="p">(</span>
        <span class="nv">initialState</span><span class="p">:</span> <span class="kt">AppState</span><span class="p">(),</span>
        <span class="nv">reducer</span><span class="p">:</span> <span class="n">appReducer</span><span class="p">,</span>
        <span class="nv">environment</span><span class="p">:</span> <span class="kt">AppEnvironment</span><span class="p">(</span>
            <span class="nv">healthService</span><span class="p">:</span> <span class="kt">HealthService</span><span class="p">(</span><span class="nv">store</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">())</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">Scene</span> <span class="p">{</span>
        <span class="cp">#if os(watchOS)</span>
        <span class="kt">WatchAppScene</span><span class="p">(</span><span class="nv">store</span><span class="p">:</span> <span class="n">store</span><span class="p">)</span>
        <span class="cp">#else</span>
        <span class="kt">MainScene</span><span class="p">(</span><span class="nv">store</span><span class="p">:</span> <span class="n">store</span><span class="p">)</span>
        <span class="cp">#endif</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="conclusion">Conclusion</h4>
<p>Today we learned another new SwiftUI API that allows us to handle scenes in a composable way. We understood how to use scenes API to build custom scenes for different platforms. I hope you enjoy the post. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this article. Thanks for reading, and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
