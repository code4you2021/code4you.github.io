<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Drag and drop in SwiftUI | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Drag and drop in SwiftUI" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Another iPadOS feature released in SwiftUI with Xcode 11.4 was the drag and drop. Finally, we can use drag and drop API not only with UIKit but also with SwiftUI. This week we will learn all about drag and drop interactions in SwiftUI." />
<meta property="og:description" content="Another iPadOS feature released in SwiftUI with Xcode 11.4 was the drag and drop. Finally, we can use drag and drop API not only with UIKit but also with SwiftUI. This week we will learn all about drag and drop interactions in SwiftUI." />
<link rel="canonical" href="http://localhost:4000/2020/04/01/drag-and-drop-in-swiftui/" />
<meta property="og:url" content="http://localhost:4000/2020/04/01/drag-and-drop-in-swiftui/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:image" content="http://localhost:4000/public/draganddrop.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-04-01T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/public/draganddrop.png" />
<meta property="twitter:title" content="Drag and drop in SwiftUI" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/04/01/drag-and-drop-in-swiftui/"},"url":"http://localhost:4000/2020/04/01/drag-and-drop-in-swiftui/","image":"http://localhost:4000/public/draganddrop.png","author":{"@type":"Person","name":"Code4You"},"headline":"Drag and drop in SwiftUI","description":"Another iPadOS feature released in SwiftUI with Xcode 11.4 was the drag and drop. Finally, we can use drag and drop API not only with UIKit but also with SwiftUI. This week we will learn all about drag and drop interactions in SwiftUI.","dateModified":"2020-04-01T00:00:00+08:00","datePublished":"2020-04-01T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">Drag and drop in SwiftUI</h2>
  <time datetime="2020-04-01T00:00:00+08:00" class="post-date">01 Apr 2020</time>
  <p>Another <em>iPadOS</em> feature released in SwiftUI with Xcode 11.4 was the drag and drop. Finally, we can use drag and drop API not only with <em>UIKit</em> but also with SwiftUI. This week we will learn all about drag and drop interactions in SwiftUI.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<h4 id="basics">Basics</h4>
<p>Drag and drop interactions allow users to send data between two apps or two scenes of the same app. For example, you can run Safari and Notes apps side-by-side and drag the links from Safari to Notes app. As part of the post, we will build a bookmarking app that uses drag and drop to save or open links stored in the app.</p>

<h4 id="drag">Drag</h4>
<p>SwiftUI provides <em>onDrag</em> modifier that allows us to register a closure that will create and return <em>NSItemProvider</em>. <em>NSItemProvider</em> is the class that describes the content and the type of draggable item. Let’s take a look at how we can use <em>onDrag</em> modifier.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">BookmarksList</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">links</span><span class="p">:</span> <span class="p">[</span><span class="kt">URL</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://twitter.com/mecid"</span><span class="p">)</span><span class="o">!</span>
    <span class="p">]</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">List</span> <span class="p">{</span>
            <span class="kt">ForEach</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">url</span> <span class="k">in</span>
                <span class="kt">Text</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">absoluteString</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">onDrag</span> <span class="p">{</span> <span class="kt">NSItemProvider</span><span class="p">(</span><span class="nv">object</span><span class="p">:</span> <span class="n">url</span> <span class="k">as</span> <span class="kt">NSURL</span><span class="p">)</span> <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">navigationBarTitle</span><span class="p">(</span><span class="s">"Bookmarks"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see in the example above, all we need to do is to use <em>onDrag</em> modifier that returns an instance of <em>NSItemProvider</em>. Now you can run the app on the iPad simulator side-by-side with Safari and try to drag and drop the link from our app to Safari.</p>

<h4 id="drop">Drop</h4>
<p>Unlike drag operation, drop interaction is a little bit complicated. SwiftUI gave us three overloads of <em>onDrop</em> modifier. The most interesting one is the overload that accepts <em>DropDelegate</em>. <em>DropDelegate</em> is the protocol that we can implement to control drop interaction. Let’s take a look at the quick example.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">BookmarksDropDelegate</span><span class="p">:</span> <span class="kt">DropDelegate</span> <span class="p">{</span>
    <span class="kd">@Binding</span> <span class="k">var</span> <span class="nv">bookmarks</span><span class="p">:</span> <span class="p">[</span><span class="kt">URL</span><span class="p">]</span>

    <span class="kd">func</span> <span class="nf">performDrop</span><span class="p">(</span><span class="nv">info</span><span class="p">:</span> <span class="kt">DropInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="n">info</span><span class="o">.</span><span class="nf">hasItemsConforming</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">[</span><span class="s">"public.url"</span><span class="p">])</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">items</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="nf">itemProviders</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="p">[</span><span class="s">"public.url"</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">items</span> <span class="p">{</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="nf">loadObject</span><span class="p">(</span><span class="nv">ofClass</span><span class="p">:</span> <span class="kt">URL</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">url</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">url</span> <span class="p">{</span>
                    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
                        <span class="k">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nv">at</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we have a <em>BookmarksDropDelegate</em> struct that conforms to <em>DropDelegate</em> protocol. <em>DropDelegate</em> protocol requires us to implement <em>performDrop</em> function. This function should return <em>true</em> whenever the drop succeeded or <em>false</em> if it failed. <em>performDrop</em> function has <em>DropInfo</em> parameter, which provides us the information about items that should be dropped.</p>

<p>Using <em>DropInfo</em>, we can filter items and accept only links. Apple uses <em>Uniform Type Identifiers</em> to identify the type of data. We want to receive only URLs that’s why we use <strong>public.link</strong> identifier. <em>DropInfo</em> also provides us the location of drop using <em>CGPoint</em> instance.</p>

<blockquote>
  <p>To learn more about <em>Uniform Type Identifiers</em>, take a look at <a href="https://developer.apple.com/library/archive/documentation/FileManagement/Conceptual/understanding_utis/understand_utis_intro/understand_utis_intro.html">Apple’s documentation</a>.</p>
</blockquote>

<p><em>DropDelegate</em> also has a few not required functions that we can use to understand when dropping started and ended.
Finally, we are ready to register our <em>BookmarksDropDelegate</em> on the <em>List</em> or <em>ForEach</em> to enable drop interaction.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">BookmarksList</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">links</span><span class="p">:</span> <span class="p">[</span><span class="kt">URL</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://twitter.com/mecid"</span><span class="p">)</span><span class="o">!</span>
    <span class="p">]</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">List</span> <span class="p">{</span>
            <span class="kt">ForEach</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">url</span> <span class="k">in</span>
                <span class="kt">Text</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">absoluteString</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">onDrag</span> <span class="p">{</span> <span class="kt">NSItemProvider</span><span class="p">(</span><span class="nv">object</span><span class="p">:</span> <span class="n">url</span> <span class="k">as</span> <span class="kt">NSURL</span><span class="p">)</span> <span class="p">}</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="nf">onDrop</span><span class="p">(</span>
                <span class="nv">of</span><span class="p">:</span> <span class="p">[</span><span class="s">"public.url"</span><span class="p">],</span>
                <span class="nv">delegate</span><span class="p">:</span> <span class="kt">BookmarksDropDelegate</span><span class="p">(</span><span class="nv">bookmarks</span><span class="p">:</span> <span class="err">$</span><span class="n">links</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">navigationBarTitle</span><span class="p">(</span><span class="s">"Bookmarks"</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Unfortunately, <em>onDrop</em> modifier doesn’t affect the <em>List</em> or any view that inside a <em>List</em>. It works well with <em>VStack</em>, <em>ScrollView</em>, and other views. But it doesn’t work with the <em>List</em>.</p>

<p>I hope it is a bug, and Apple will fix it soon. We can replace the <em>List</em> with <em>ScrollView</em> to make <em>onDrop</em> modifier working. But in this case, we will lose all the features of the <em>List</em> component.</p>

<h4 id="insert">Insert</h4>
<p>Gladly, SwiftUI provides us another modifier that we can use on <em>ForEach</em> view. <em>onInsert</em> modifier looks like a simplified version of <em>onDrop</em> modifier, and it works inside <em>List</em> component. Let’s take a look at the quick usage example of <em>onInsert</em> modifier.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">BookmarksList</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">links</span><span class="p">:</span> <span class="p">[</span><span class="kt">URL</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://twitter.com/mecid"</span><span class="p">)</span><span class="o">!</span>
    <span class="p">]</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">List</span> <span class="p">{</span>
            <span class="kt">ForEach</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">url</span> <span class="k">in</span>
                <span class="kt">Text</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">absoluteString</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">onDrag</span> <span class="p">{</span> <span class="kt">NSItemProvider</span><span class="p">(</span><span class="nv">object</span><span class="p">:</span> <span class="n">url</span> <span class="k">as</span> <span class="kt">NSURL</span><span class="p">)</span> <span class="p">}</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="nf">onInsert</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="p">[</span><span class="s">"public.url"</span><span class="p">],</span> <span class="nv">perform</span><span class="p">:</span> <span class="n">drop</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">navigationBarTitle</span><span class="p">(</span><span class="s">"Bookmarks"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">drop</span><span class="p">(</span><span class="n">at</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="n">_</span> <span class="nv">items</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSItemProvider</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">items</span> <span class="p">{</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="nf">loadObject</span><span class="p">(</span><span class="nv">ofClass</span><span class="p">:</span> <span class="kt">URL</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">url</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
                <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
                    <span class="n">url</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="k">self</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="nv">$0</span><span class="p">,</span> <span class="nv">at</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span> <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see, we use <em>onInsert</em> modifier to accept the insertion of links. We also pass the drop function that handles the process of loading the URL object and insertion.</p>

<h4 id="conclusion">Conclusion</h4>
<p>Today we learned another new feature that released with Xcode 11.4. Please note that all drag and drop related modifiers are available as part of iOS 13.4. I hope you enjoy the post. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this post. Thanks for reading, and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
