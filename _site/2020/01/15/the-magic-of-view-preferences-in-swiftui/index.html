<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>The magic of view preferences in SwiftUI | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="The magic of view preferences in SwiftUI" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I took a one week break from SwiftUI topic when we were talking about building networking in Swift using functions. It’s time to go back to SwiftUI. This week we will talk about view preferences, which is another powerful concept of SwiftUI views that allows us to pass data through view hierarchy." />
<meta property="og:description" content="I took a one week break from SwiftUI topic when we were talking about building networking in Swift using functions. It’s time to go back to SwiftUI. This week we will talk about view preferences, which is another powerful concept of SwiftUI views that allows us to pass data through view hierarchy." />
<link rel="canonical" href="http://localhost:4000/2020/01/15/the-magic-of-view-preferences-in-swiftui/" />
<meta property="og:url" content="http://localhost:4000/2020/01/15/the-magic-of-view-preferences-in-swiftui/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:image" content="http://localhost:4000/public/swiftui.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-01-15T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/public/swiftui.png" />
<meta property="twitter:title" content="The magic of view preferences in SwiftUI" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/01/15/the-magic-of-view-preferences-in-swiftui/"},"url":"http://localhost:4000/2020/01/15/the-magic-of-view-preferences-in-swiftui/","image":"http://localhost:4000/public/swiftui.png","author":{"@type":"Person","name":"Code4You"},"headline":"The magic of view preferences in SwiftUI","description":"I took a one week break from SwiftUI topic when we were talking about building networking in Swift using functions. It’s time to go back to SwiftUI. This week we will talk about view preferences, which is another powerful concept of SwiftUI views that allows us to pass data through view hierarchy.","dateModified":"2020-01-15T00:00:00+08:00","datePublished":"2020-01-15T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">The magic of view preferences in SwiftUI</h2>
  <time datetime="2020-01-15T00:00:00+08:00" class="post-date">15 Jan 2020</time>
  <p>I took a one week break from SwiftUI topic when we were talking about <a href="/2020/01/08/building-networking-layer-using-functions/">building networking in Swift using functions</a>. It’s time to go back to SwiftUI. This week we will talk about view preferences, which is another powerful concept of SwiftUI views that allows us to pass data through view hierarchy.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<h4 id="preferences">Preferences</h4>
<p>SwiftUI has the environment concept which we can use to pass data down into a view hierarchy. Parent views share its environment with child views and subscribe to the changes. But sometimes we need to pass data up from child view to the parent view, and this is where preferences shine. Let’s take a look at the small example.</p>

<blockquote>
  <p>To learn more about the benefits of the environment feature take a look at <a href="/2019/08/21/the-power-of-environment-in-swiftui/">“The power of Environment in SwiftUI” post</a>.</p>
</blockquote>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>

<span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">messages</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">NavigationView</span> <span class="p">{</span>
            <span class="kt">List</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">message</span> <span class="k">in</span>
                <span class="kt">Text</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="p">}</span><span class="o">.</span><span class="nf">navigationBarTitle</span><span class="p">(</span><span class="s">"Messages"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here is an excellent example of preference usage. <em>navigationBarTitle</em> modifier uses the preference feature to pass the data up to the <em>NavigationView</em>, which renders it in the navigation bar. Let’s take a look at the possible internal implementation of the <em>navigationBarTitle</em> modifier.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>

<span class="kd">struct</span> <span class="kt">NavigationBarTitleKey</span><span class="p">:</span> <span class="kt">PreferenceKey</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">defaultValue</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">reduce</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">nextValue</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nf">nextValue</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">navigationBarTitle</span><span class="p">(</span><span class="n">_</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">preference</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="kt">NavigationBarTitleKey</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="n">title</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In order to use preferences, we need to declare a struct conforming <em>PreferenceKey</em> protocol. <em>PreferenceKey</em> has two requirements, default value for preference and reduce method. Reduce method maintains the logic that combines multiple values into a single one. You might need to replace or append values. In our case, we need to replace the old title with the current one. As you can see, we use a preference modifier to set a value.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">messages</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">NavigationView</span> <span class="p">{</span>
            <span class="kt">List</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">message</span> <span class="k">in</span>
                <span class="kt">Text</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="p">}</span><span class="o">.</span><span class="nf">navigationBarTitle</span><span class="p">(</span><span class="s">"Messages"</span><span class="p">)</span>
        <span class="p">}</span><span class="o">.</span><span class="nf">onPreferenceChange</span><span class="p">(</span><span class="kt">NavigationBarTitleKey</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">title</span> <span class="k">in</span>
            <span class="c1">// you have to set title value in the navigation bar here</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the example above, we use the <em>onPreferenceChange</em> modifier to observe <em>NavigationBarTitleKey</em>. SwiftUI will call this closure whenever view sets a new value for the preference.</p>

<h4 id="understanding-the-size-of-child-view">Understanding the size of child view</h4>
<p>Sometimes we need to get the size of the child view to make some offset, and it is another excellent example of preference usage in SwiftUI. Let’s take a look at how we can use preferences to fetch the size of the child view.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">SizePreferenceKey</span><span class="p">:</span> <span class="kt">PreferenceKey</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">defaultValue</span><span class="p">:</span> <span class="kt">CGSize</span> <span class="o">=</span> <span class="o">.</span><span class="n">zero</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">reduce</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">CGSize</span><span class="p">,</span> <span class="nv">nextValue</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">CGSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nf">nextValue</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">SizeModifier</span><span class="p">:</span> <span class="kt">ViewModifier</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">sizeView</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">GeometryReader</span> <span class="p">{</span> <span class="n">geometry</span> <span class="k">in</span>
            <span class="kt">Color</span><span class="o">.</span><span class="n">clear</span><span class="o">.</span><span class="nf">preference</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="kt">SizePreferenceKey</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">body</span><span class="p">(</span><span class="nv">content</span><span class="p">:</span> <span class="kt">Content</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="n">content</span><span class="o">.</span><span class="nf">background</span><span class="p">(</span><span class="n">sizeView</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we have a <em>SizeModifier</em> struct, which attaches a geometry reader to a view as a background to read its size. It is a pretty useful technique that allows us to calculate the size of the view. Now we can understand the size of the view using <em>onPreferenceChange</em> modifier.</p>

<blockquote>
  <p>To learn more about the benefits of the view modifiers take a look at <a href="/2019/08/07/viewmodifiers-in-swiftui/">“ViewModifiers in SwiftUI” post</a>.</p>
</blockquote>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ScrollView</span><span class="o">&lt;</span><span class="kt">Content</span><span class="p">:</span> <span class="kt">View</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">content</span><span class="p">:</span> <span class="kt">Content</span>

    <span class="kd">@GestureState</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">translation</span><span class="p">:</span> <span class="kt">CGSize</span> <span class="o">=</span> <span class="o">.</span><span class="n">zero</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">contentSize</span><span class="p">:</span> <span class="kt">CGSize</span> <span class="o">=</span> <span class="o">.</span><span class="n">zero</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">offset</span><span class="p">:</span> <span class="kt">CGSize</span> <span class="o">=</span> <span class="o">.</span><span class="n">zero</span>

    <span class="kd">private</span> <span class="k">var</span> <span class="nv">dragGesture</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">Gesture</span> <span class="p">{</span>
        <span class="kt">DragGesture</span><span class="p">(</span><span class="nv">minimumDistance</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">updating</span><span class="p">(</span><span class="err">$</span><span class="n">translation</span><span class="p">)</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">translation</span>
        <span class="p">}</span><span class="o">.</span><span class="n">onEnded</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
            <span class="k">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">translation</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nf">init</span><span class="p">(</span><span class="kd">@ViewBuilder</span> <span class="nv">content</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Content</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="nf">content</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">GeometryReader</span> <span class="p">{</span> <span class="n">geometry</span> <span class="k">in</span>
            <span class="k">self</span><span class="o">.</span><span class="n">content</span>
                <span class="o">.</span><span class="nf">fixedSize</span><span class="p">()</span>
                <span class="o">.</span><span class="nf">offset</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">offset</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">translation</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">modifier</span><span class="p">(</span><span class="kt">SizeModifier</span><span class="p">())</span>
                <span class="o">.</span><span class="nf">onPreferenceChange</span><span class="p">(</span><span class="kt">SizePreferenceKey</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="k">self</span><span class="o">.</span><span class="n">contentSize</span> <span class="o">=</span> <span class="nv">$0</span> <span class="p">}</span>
                <span class="o">.</span><span class="nf">gesture</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="nf">isScrollable</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">?</span> <span class="k">self</span><span class="o">.</span><span class="nv">dragGesture</span> <span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="p">}</span><span class="o">.</span><span class="nf">clipped</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">isScrollable</span><span class="p">(</span><span class="n">_</span> <span class="nv">size</span><span class="p">:</span> <span class="kt">CGSize</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="n">contentSize</span><span class="o">.</span><span class="n">width</span> <span class="o">&gt;</span> <span class="n">size</span><span class="o">.</span><span class="n">width</span> <span class="o">||</span> <span class="n">contentSize</span><span class="o">.</span><span class="n">height</span> <span class="o">&gt;</span> <span class="n">size</span><span class="o">.</span><span class="n">height</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here is the possible implementation of <em>ScrollView</em> that uses preferences to understand the size of its content and enable/disable scrolling based on that value. I use this implementation only for the demo, please don’t use it in production.</p>

<h4 id="conclusion">Conclusion</h4>
<p>Today we talked about another very great feature of SwiftUI. Preferences feature has the same power as the environment, but instead, it uses reversed direction to pass the data. I’m sure you won’t need it very often, but you should know about it. I hope you enjoy the post. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this post. Thanks for reading, and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
