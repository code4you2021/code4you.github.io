<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Optimizing views in SwiftUI using EquatableView | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Optimizing views in SwiftUI using EquatableView" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="SwiftUI provides us a very fast and easy to use diffing algorithm, but as you might know, diffing is a linear operation. It means that diffing will be very fast for simple layouts and can take some time for a complicated layout." />
<meta property="og:description" content="SwiftUI provides us a very fast and easy to use diffing algorithm, but as you might know, diffing is a linear operation. It means that diffing will be very fast for simple layouts and can take some time for a complicated layout." />
<link rel="canonical" href="http://localhost:4000/2020/01/22/optimizing-views-in-swiftui-using-equatableview/" />
<meta property="og:url" content="http://localhost:4000/2020/01/22/optimizing-views-in-swiftui-using-equatableview/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:image" content="http://localhost:4000/public/equatable.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-01-22T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/public/equatable.png" />
<meta property="twitter:title" content="Optimizing views in SwiftUI using EquatableView" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/01/22/optimizing-views-in-swiftui-using-equatableview/"},"url":"http://localhost:4000/2020/01/22/optimizing-views-in-swiftui-using-equatableview/","image":"http://localhost:4000/public/equatable.png","author":{"@type":"Person","name":"Code4You"},"headline":"Optimizing views in SwiftUI using EquatableView","description":"SwiftUI provides us a very fast and easy to use diffing algorithm, but as you might know, diffing is a linear operation. It means that diffing will be very fast for simple layouts and can take some time for a complicated layout.","dateModified":"2020-01-22T00:00:00+08:00","datePublished":"2020-01-22T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">Optimizing views in SwiftUI using EquatableView</h2>
  <time datetime="2020-01-22T00:00:00+08:00" class="post-date">22 Jan 2020</time>
  <p>SwiftUI provides us a very fast and easy to use diffing algorithm, but as you might know, diffing is a linear operation. It means that diffing will be very fast for simple layouts and can take some time for a complicated layout.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<p>I have good news for you. SwiftUI allows us to replace the standalone diffing algorithm with our custom logic. This week we will talk about optimizing our SwiftUI layouts using the equatable modifier.</p>

<h4 id="diffing-in-swiftui">Diffing in SwiftUI</h4>
<p>As you remember, we already talked about diffing in SwiftUI, but let me remind how it works. Whenever you change the source of truth for your views like <em>@State</em> or <em>@ObservableObject</em>, SwiftUI runs <em>body</em> property of your view to generate a new one. As the last step, SwiftUI renders a new view if something changed. The process of calculating a new <em>body</em> depends on how deep is your view hierarchy. Happily, we can replace SwiftUI diffing with our simplified version whenever we know the better way to determine changes.</p>

<blockquote>
  <p>To learn more about diffing, take a look at <a href="/2019/11/19/you-have-to-change-mindset-to-use-swiftui/">“You have to change mindset to use SwiftUI” post</a>.</p>
</blockquote>

<h4 id="equatableview">EquatableView</h4>
<p>Sometimes we don’t need the true diffing of SwiftUI, or we want to ignore some changes in data, and this is the exact place where we can use the <em>EquatableView</em> struct. <em>EquatableView</em> struct is a wrapper for a <em>View</em>, and it also conforms to <em>View</em> protocol. All you need to do to use <em>EquatableView</em> is conforming your view to <em>Equatable</em> protocol. Let’s take a simple look at a good example.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">CalendarView</span><span class="p">:</span> <span class="kt">View</span><span class="p">,</span> <span class="kt">Equatable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">sleeps</span><span class="p">:</span> <span class="p">[</span><span class="kt">Date</span><span class="p">:</span> <span class="p">[</span><span class="kt">Sleep</span><span class="p">]]</span>
    <span class="k">let</span> <span class="nv">dates</span><span class="p">:</span> <span class="p">[</span><span class="kt">Date</span><span class="p">]</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">List</span> <span class="p">{</span>
            <span class="kt">ForEach</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">date</span> <span class="k">in</span>
                <span class="kt">Section</span><span class="p">(</span><span class="nv">header</span><span class="p">:</span> <span class="kt">Text</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">date</span><span class="p">,</span> <span class="nv">formatter</span><span class="p">:</span> <span class="kt">DateFormatter</span><span class="o">.</span><span class="n">mediumDate</span><span class="se">)</span><span class="s">"</span><span class="p">))</span> <span class="p">{</span>
                    <span class="kt">ForEach</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">sleeps</span><span class="p">[</span><span class="n">date</span><span class="p">,</span> <span class="k">default</span><span class="p">:</span> <span class="p">[]],</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span> <span class="n">sleep</span> <span class="k">in</span>
                        <span class="kt">CalendarRow</span><span class="p">(</span><span class="nv">sleep</span><span class="p">:</span> <span class="n">sleep</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="o">.</span><span class="nf">listStyle</span><span class="p">(</span><span class="kt">GroupedListStyle</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the example above, you see the code from my NapBot app. It is a calendar view that represents your sleep per day. I decide to replace SwiftUI diffing with my own by adding <em>Equatable</em> conformance. As you can see, it is a straightforward process. You can go further by overriding <em>== function</em> and adding your custom logic there.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">CalendarView</span><span class="p">:</span> <span class="kt">View</span><span class="p">,</span> <span class="kt">Equatable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">sleeps</span><span class="p">:</span> <span class="p">[</span><span class="kt">Date</span><span class="p">:</span> <span class="p">[</span><span class="kt">Sleep</span><span class="p">]]</span>
    <span class="k">let</span> <span class="nv">dates</span><span class="p">:</span> <span class="p">[</span><span class="kt">Date</span><span class="p">]</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">List</span> <span class="p">{</span>
            <span class="kt">ForEach</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">date</span> <span class="k">in</span>
                <span class="kt">Section</span><span class="p">(</span><span class="nv">header</span><span class="p">:</span> <span class="kt">Text</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">date</span><span class="p">,</span> <span class="nv">formatter</span><span class="p">:</span> <span class="kt">DateFormatter</span><span class="o">.</span><span class="n">mediumDate</span><span class="se">)</span><span class="s">"</span><span class="p">))</span> <span class="p">{</span>
                    <span class="kt">ForEach</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">sleeps</span><span class="p">[</span><span class="n">date</span><span class="p">,</span> <span class="k">default</span><span class="p">:</span> <span class="p">[]],</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span> <span class="n">sleep</span> <span class="k">in</span>
                        <span class="kt">CalendarRow</span><span class="p">(</span><span class="nv">sleep</span><span class="p">:</span> <span class="n">sleep</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="o">.</span><span class="nf">listStyle</span><span class="p">(</span><span class="kt">GroupedListStyle</span><span class="p">())</span>
    <span class="p">}</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="o">==</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="k">Self</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="k">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="n">lhs</span><span class="o">.</span><span class="n">sleeps</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">sleeps</span><span class="o">.</span><span class="n">count</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now we can wrap our <em>CalendarView</em> with <em>EquatableView</em>.</p>

<p><strong>Remember, you have to wrap your view with EquatableView to replace standalone diffing with yours.</strong></p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">CalendarContainerView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@EnvironmentObject</span> <span class="k">var</span> <span class="nv">store</span><span class="p">:</span> <span class="kt">CalendarStore</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">EquatableView</span><span class="p">(</span>
            <span class="kt">CalendarView</span><span class="p">(</span>
                <span class="nv">sleeps</span><span class="p">:</span> <span class="n">store</span><span class="o">.</span><span class="n">sleeps</span><span class="p">,</span>
                <span class="nv">dates</span><span class="p">:</span> <span class="n">store</span><span class="o">.</span><span class="n">dates</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="nf">onAppear</span><span class="p">(</span><span class="nv">perform</span><span class="p">:</span> <span class="n">store</span><span class="o">.</span><span class="n">fetch</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="equatable-modifier">Equatable modifier</h4>
<p>SwiftUI allows us to avoid wrapping with <em>EquatableView</em> by using an equatable modifier. Basically, it does the same thing but in a short way.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">CalendarContainerView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@EnvironmentObject</span> <span class="k">var</span> <span class="nv">store</span><span class="p">:</span> <span class="kt">CalendarStore</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">CalendarView</span><span class="p">(</span><span class="nv">sleeps</span><span class="p">:</span> <span class="n">store</span><span class="o">.</span><span class="n">sleeps</span><span class="p">,</span> <span class="nv">dates</span><span class="p">:</span> <span class="n">store</span><span class="o">.</span><span class="n">dates</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">equatable</span><span class="p">()</span>
            <span class="o">.</span><span class="nf">onAppear</span><span class="p">(</span><span class="nv">perform</span><span class="p">:</span> <span class="n">store</span><span class="o">.</span><span class="n">fetch</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="container-views-and-equatable-rendering-views">Container views and equatable rendering views</h4>
<p>It is so easy to add <em>Equatable</em> conformance to your view when it only renders some data. You even don’t need to override <em>== function</em>. You can quickly achieve this behavior by extracting your views into <em>Container</em> and <em>Rendering</em> views. We already talked multiple times on my blog about <em>Container</em> and <em>Rendering</em> views. <em>Rendering</em> views simply take some data and render it. That’s it.</p>

<p><em>Rendering</em> views should not contain any logic or state manipulations, and it should delegate them to <em>Container</em> views. This separation allows you to make your <em>Rendering</em> views conforming <em>Equatable</em> in an effortless way.</p>

<blockquote>
  <p>To learn more about <em>Container and Rendering views</em>, take a look at my <a href="/2019/07/31/introducing-container-views-in-swiftui/">“Introducing Container views in SwiftUI” post</a>.</p>
</blockquote>

<h4 id="conclusion">Conclusion</h4>
<p>SwiftUI allows us to build our apps in a very new way, where the framework itself applies a lot of magic behind the scene. But I’m delighted that SwiftUI provides so many capabilities to customize default behavior. <em>EquatableView</em> can boost performance when <em>body</em> computation is longer than your equality check.
I hope you enjoy the post. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this post. Thanks for reading, and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
