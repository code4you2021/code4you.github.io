<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>New property wrappers in SwiftUI | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="New property wrappers in SwiftUI" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="WWDC20 brought a lot of new features into SwiftUI that I will discuss on my blog during the next weeks. Today I would like to start with the main additions to SwiftUI data flow with the brand new @StateObject, @AppStorage, @SceneStorage, and @ScaledMetric property wrappers." />
<meta property="og:description" content="WWDC20 brought a lot of new features into SwiftUI that I will discuss on my blog during the next weeks. Today I would like to start with the main additions to SwiftUI data flow with the brand new @StateObject, @AppStorage, @SceneStorage, and @ScaledMetric property wrappers." />
<link rel="canonical" href="http://localhost:4000/2020/06/29/new-property-wrappers-in-swiftui/" />
<meta property="og:url" content="http://localhost:4000/2020/06/29/new-property-wrappers-in-swiftui/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:image" content="http://localhost:4000/public/wwdc20.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-29T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/public/wwdc20.jpg" />
<meta property="twitter:title" content="New property wrappers in SwiftUI" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/06/29/new-property-wrappers-in-swiftui/"},"url":"http://localhost:4000/2020/06/29/new-property-wrappers-in-swiftui/","image":"http://localhost:4000/public/wwdc20.jpg","author":{"@type":"Person","name":"Code4You"},"headline":"New property wrappers in SwiftUI","description":"WWDC20 brought a lot of new features into SwiftUI that I will discuss on my blog during the next weeks. Today I would like to start with the main additions to SwiftUI data flow with the brand new @StateObject, @AppStorage, @SceneStorage, and @ScaledMetric property wrappers.","dateModified":"2020-06-29T00:00:00+08:00","datePublished":"2020-06-29T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">New property wrappers in SwiftUI</h2>
  <time datetime="2020-06-29T00:00:00+08:00" class="post-date">29 Jun 2020</time>
  <p>WWDC20 brought a lot of new features into SwiftUI that I will discuss on my blog during the next weeks. Today I would like to start with the main additions to SwiftUI data flow with the brand new @<em>StateObject</em>, @<em>AppStorage</em>, @<em>SceneStorage</em>, and @<em>ScaledMetric</em> property wrappers.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<h4 id="stateobject">StateObject</h4>
<p>As you remember, SwiftUI provides us the @<em>ObservedObject</em> property wrapper that allows us to observe the changes in the data model that lives outside of the SwiftUI framework. For example, it might be the data that you fetch from web service or the local database. The main concern about @<em>ObservedObject</em> was the lifecycle. You have to store it somewhere outside of SwiftUI to save it during view updates, for example, in <em>SceneDelegate</em> or <em>AppDelegate</em>. In other cases, you can lose the data backed by @<em>ObservedObject</em> in certain circumstances.</p>

<blockquote>
  <p>If you are not familiar with the legacy property wrappers that SwiftUI provides, I suggest to start with my <a href="/2019/06/12/understanding-property-wrappers-in-swiftui/">“Understanding Property Wrappers in SwiftUI”</a> post.</p>
</blockquote>

<p>Here is the brand new <em>StateObject</em> property wrapper that fills the most significant gap in SwiftUI data flow management. SwiftUI creates only one instance of the <em>StateObject</em> for each container instance that you declare and holds it in the internal framework memory that saves it during view updates. <em>StateObject</em> works in a very similar way to <em>State</em> property wrapper, but instead of value types, it is designed to work with reference types.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">CalendarContainerView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@StateObject</span> <span class="k">var</span> <span class="nv">viewModel</span> <span class="o">=</span> <span class="kt">ViewModel</span><span class="p">()</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">CalendarView</span><span class="p">(</span><span class="n">viewModel</span><span class="o">.</span><span class="n">dates</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">onAppear</span><span class="p">(</span><span class="nv">perform</span><span class="p">:</span> <span class="n">viewModel</span><span class="o">.</span><span class="n">fetch</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="appstorage">AppStorage</h4>
<p><em>AppStorage</em> is another new property wrapper that we have this year. It is a perfect way to store a small amount of key-value data backed by <em>UserDefaults</em>. <em>AppStorage</em> is <em>DynamicProperty</em>, which means SwiftUI will update your views as soon as the value of a particular key in <em>UserDefaults</em> will update. <em>AppStorage</em> perfectly fits to store app settings. Let’s take a look at how we can use it.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="kt">Settings</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">notifications</span> <span class="o">=</span> <span class="s">"notifications"</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">sleepGoal</span> <span class="o">=</span> <span class="s">"sleepGoal"</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">SettingsView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@AppStorage</span><span class="p">(</span><span class="kt">Settings</span><span class="o">.</span><span class="n">notifications</span><span class="p">)</span> <span class="k">var</span> <span class="nv">notifications</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="kd">@AppStorage</span><span class="p">(</span><span class="kt">Settings</span><span class="o">.</span><span class="n">sleepGoal</span><span class="p">)</span> <span class="k">var</span> <span class="nv">sleepGoal</span><span class="p">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">8.0</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">Form</span> <span class="p">{</span>
            <span class="kt">Section</span> <span class="p">{</span>
                <span class="kt">Toggle</span><span class="p">(</span><span class="s">"Notifications"</span><span class="p">,</span> <span class="nv">isOn</span><span class="p">:</span> <span class="err">$</span><span class="n">notifications</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="kt">Section</span> <span class="p">{</span>
                <span class="kt">Stepper</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="err">$</span><span class="n">sleepGoal</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="mi">6</span><span class="o">...</span><span class="mi">12</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kt">Text</span><span class="p">(</span><span class="s">"Sleep goal is </span><span class="se">\(</span><span class="n">sleepGoal</span><span class="p">,</span> <span class="nv">specifier</span><span class="p">:</span> <span class="s">"%.f"</span><span class="se">)</span><span class="s"> hr"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the example above, we build a settings screen using the <em>AppStorage</em> property wrapper and <em>Form</em> view. Now we can access our settings anywhere across the app using <em>AppStorage</em>, and as soon as we change the values, SwiftUI will update the views.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@AppStorage</span><span class="p">(</span><span class="kt">Settings</span><span class="o">.</span><span class="n">sleepGoal</span><span class="p">)</span> <span class="k">var</span> <span class="nv">sleepGoal</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="kd">@StateObject</span> <span class="k">var</span> <span class="nv">store</span> <span class="o">=</span> <span class="kt">SleepStore</span><span class="p">()</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">WeeklySleepChart</span><span class="p">(</span><span class="n">store</span><span class="o">.</span><span class="n">sleeps</span><span class="p">,</span> <span class="nv">goal</span><span class="p">:</span> <span class="n">sleepGoal</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">onAppear</span><span class="p">(</span><span class="nv">perform</span><span class="p">:</span> <span class="n">store</span><span class="o">.</span><span class="n">fetch</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="scenestorage">SceneStorage</h4>
<p>This year we got all the abilities to control scenes in SwiftUI without UIKit. As a result, we have a new <em>SceneStorage</em> property wrapper that allows us to implement proper state restoration for our scenes. <em>SceneStorage</em> works similarly to <em>AppStorage</em>, but instead of <em>UserDefaults</em>, it uses per-scene storage. It means every scene has its private storage that can’t be accessed by other scenes. The system entirely responsible for managing per-scene storage, and you don’t have access to the data without <em>SceneStorage</em> property wrapper.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@SceneStorage</span><span class="p">(</span><span class="s">"selectedTab"</span><span class="p">)</span> <span class="k">var</span> <span class="nv">selection</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">TabView</span><span class="p">(</span><span class="nv">selection</span><span class="p">:</span> <span class="err">$</span><span class="n">selection</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">Text</span><span class="p">(</span><span class="s">"Tab 1"</span><span class="p">)</span><span class="o">.</span><span class="nf">tag</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="kt">Text</span><span class="p">(</span><span class="s">"Tab 2"</span><span class="p">)</span><span class="o">.</span><span class="nf">tag</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>I recommend using <em>SceneStorage</em> to store scene-specific data like tab selection or selected book index in a reader app. Nowadays, iOS is very aggressive in terms of killing apps in the background, and state restoration is the key solution to provide a great user experience.</p>

<h4 id="scaledmetric">ScaledMetric</h4>
<p>Another brand new property wrapper that we have is <em>ScaledMetric</em>. <em>ScaledMetric</em> allows us to scale any binary floating value relative to the Dynamic Type size category. For example, it is so easy to change the spacing in your app according to the Dynamic Type size category. Let’s take a look at the small example.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@ScaledMetric</span><span class="p">(</span><span class="nv">relativeTo</span><span class="p">:</span> <span class="o">.</span><span class="n">body</span><span class="p">)</span> <span class="k">var</span> <span class="nv">spacing</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">8</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span><span class="p">(</span><span class="nv">spacing</span><span class="p">:</span> <span class="n">spacing</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">ForEach</span><span class="p">(</span><span class="mi">0</span><span class="o">...</span><span class="mi">10</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">number</span> <span class="k">in</span>
                <span class="kt">Text</span><span class="p">(</span><span class="kt">String</span><span class="p">(</span><span class="n">number</span><span class="p">))</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As soon as user changes the Dynamic Type settings, SwiftUI scales the value of spacing and update the view.</p>

<h4 id="conclusion">Conclusion</h4>
<p>Today we learned about new property wrappers in SwiftUI. I believe there are enough data flow property wrappers that can cover any logic we need while implementing our apps. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this post. Thanks for reading, and have a nice week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
