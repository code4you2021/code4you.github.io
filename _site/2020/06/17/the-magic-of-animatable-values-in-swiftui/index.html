<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="swift ios development apple watch iphone ipad swiftui macos uikit dev wwdc tutorial guide redux tea state container" />

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>The magic of Animatable values in SwiftUI | Code4You</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="The magic of Animatable values in SwiftUI" />
<meta name="author" content="Code4You" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="WWDC20 is already around the corner, and we are waiting for massive changes and additions to the SwiftUI framework. It is a perfect week to wrap up the season with a post about one of the strongest sides of the SwiftUI framework, which is animation. Today we will learn how to build complex animations by using VectorArithmetic protocol." />
<meta property="og:description" content="WWDC20 is already around the corner, and we are waiting for massive changes and additions to the SwiftUI framework. It is a perfect week to wrap up the season with a post about one of the strongest sides of the SwiftUI framework, which is animation. Today we will learn how to build complex animations by using VectorArithmetic protocol." />
<link rel="canonical" href="http://localhost:4000/2020/06/17/the-magic-of-animatable-values-in-swiftui/" />
<meta property="og:url" content="http://localhost:4000/2020/06/17/the-magic-of-animatable-values-in-swiftui/" />
<meta property="og:site_name" content="Code4You" />
<meta property="og:image" content="http://localhost:4000/public/swiftui.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-17T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/public/swiftui.png" />
<meta property="twitter:title" content="The magic of Animatable values in SwiftUI" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/06/17/the-magic-of-animatable-values-in-swiftui/"},"url":"http://localhost:4000/2020/06/17/the-magic-of-animatable-values-in-swiftui/","image":"http://localhost:4000/public/swiftui.png","author":{"@type":"Person","name":"Code4You"},"headline":"The magic of Animatable values in SwiftUI","description":"WWDC20 is already around the corner, and we are waiting for massive changes and additions to the SwiftUI framework. It is a perfect week to wrap up the season with a post about one of the strongest sides of the SwiftUI framework, which is animation. Today we will learn how to build complex animations by using VectorArithmetic protocol.","dateModified":"2020-06-17T00:00:00+08:00","datePublished":"2020-06-17T00:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="stylesheet" href="/styles.css">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Code4You" href="/feed.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <nav>
          <h1 class="masthead-title">
            <a href="/" title="Home">Code4You</a>
          </h1>
          <div>
            <a href="/categories" title="Categories">Categories</a>
            <a href="/archive" title="Archive">Archive</a>
            <a href="/feed.xml" title="Feed">Feed</a>
          </div>
        </nav>
      </header>

      <main>
        <article class="post">
  <h2 class="post-title">The magic of Animatable values in SwiftUI</h2>
  <time datetime="2020-06-17T00:00:00+08:00" class="post-date">17 Jun 2020</time>
  <p><em>WWDC20</em> is already around the corner, and we are waiting for massive changes and additions to the SwiftUI framework. It is a perfect week to wrap up the season with a post about one of the strongest sides of the SwiftUI framework, which is <em>animation</em>. Today we will learn how to build complex animations by using <em>VectorArithmetic</em> protocol.</p>

<!-- <div class="ads">
    <span>
        Why don’t more iOS apps use voice? Machine learning for voice is hard, and using Siri is clunky and rigid. So we open-sourced an iOS library (also Android, Node, Python, & React Native), and built a no-code web tool to make custom wake words, speech recognizers, and AI voices—for all devs! <a href="https://www.spokestack.io/?utm_source=swiftui_weekly&utm_medium=email&utm_campaign=maker_launch_PAID">Try it for free.</a>
    </span>
</div> -->

<h4 id="basics">Basics</h4>
<p>Let’s start with the basics. Usually, we attach the animation modifier to a view and change some state variables. SwiftUI docs say that animation modifier applies the given animation to all <strong>animatable</strong> values within this view. Here is a small example that animates the button on every tap.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">RootView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">scale</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">Button</span><span class="p">(</span><span class="s">"Press me"</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
        <span class="o">.</span><span class="nf">foregroundColor</span><span class="p">(</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">background</span><span class="p">(</span><span class="kt">Color</span><span class="o">.</span><span class="n">blue</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">cornerRadius</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">scaleEffect</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">animation</span><span class="p">(</span><span class="o">.</span><span class="k">default</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="n">scale</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>To learn more about basics of animation in SwiftUI, take a look at my <a href="/2019/06/26/animations-in-swiftui/">“Animations in SwiftUI” post</a>.</p>
</blockquote>

<p>But how SwiftUI understand which values are <strong>animatable</strong>? SwiftUI introduces a protocol called <em>Animatable</em>. This protocol has the only requirement, <em>animatableData</em> property, that describes the changes during an animation. So during the state changes, SwiftUI traverses the view hierarchy and finds all the values that conform to <em>Animatable</em> protocol and animate its changes by understanding <em>animatableData</em> of a particular item. Let’s take a look at another example.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">Line1</span><span class="p">:</span> <span class="kt">Shape</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">coordinate</span><span class="p">:</span> <span class="kt">CGFloat</span>

    <span class="kd">func</span> <span class="nf">path</span><span class="p">(</span><span class="k">in</span> <span class="nv">rect</span><span class="p">:</span> <span class="kt">CGRect</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Path</span> <span class="p">{</span>
        <span class="kt">Path</span> <span class="p">{</span> <span class="n">path</span> <span class="k">in</span>
            <span class="n">path</span><span class="o">.</span><span class="nf">move</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="o">.</span><span class="n">zero</span><span class="p">)</span>
            <span class="n">path</span><span class="o">.</span><span class="nf">addLine</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">coordinate</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">coordinate</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">RootView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">coordinate</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">Line1</span><span class="p">(</span><span class="nv">coordinate</span><span class="p">:</span> <span class="n">coordinate</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">stroke</span><span class="p">(</span><span class="kt">Color</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">animation</span><span class="p">(</span><span class="kt">Animation</span><span class="o">.</span><span class="nf">linear</span><span class="p">(</span><span class="nv">duration</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nf">repeatForever</span><span class="p">())</span>
            <span class="o">.</span><span class="n">onAppear</span> <span class="p">{</span> <span class="k">self</span><span class="o">.</span><span class="n">coordinate</span> <span class="o">=</span> <span class="mi">100</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here we have a <em>Line</em> struct that conforms to the <em>Shape</em> protocol. All shapes in SwiftUI conform to <em>Animatable</em> protocol, but as you can see, there is no animation while running the example. SwiftUI doesn’t animate our line because the framework doesn’t know how to animate it.</p>

<blockquote>
  <p>To learn more about <em>Shape API</em> in SwiftUI, take a look at my <a href="/2019/08/14/building-barchart-with-shape-api-in-swiftui/">“Building BarChart with Shape API in SwiftUI” post</a>.</p>
</blockquote>

<p>By default, shape returns the instance of <em>EmptyAnimatableData</em> struct as its <em>animatableData</em>. SwiftUI allows us to use <em>EmptyAnimatableData</em> whenever we don’t know how to animate the value. Let’s solve the problem by replacing <em>EmptyAnimatableData</em> with some value.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">Line1</span><span class="p">:</span> <span class="kt">Shape</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">coordinate</span><span class="p">:</span> <span class="kt">CGFloat</span>

    <span class="k">var</span> <span class="nv">animatableData</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="n">coordinate</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="n">coordinate</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">path</span><span class="p">(</span><span class="k">in</span> <span class="nv">rect</span><span class="p">:</span> <span class="kt">CGRect</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Path</span> <span class="p">{</span>
        <span class="kt">Path</span> <span class="p">{</span> <span class="n">path</span> <span class="k">in</span>
            <span class="n">path</span><span class="o">.</span><span class="nf">move</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="o">.</span><span class="n">zero</span><span class="p">)</span>
            <span class="n">path</span><span class="o">.</span><span class="nf">addLine</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">coordinate</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">coordinate</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the example above, we made our <em>Line</em> struct animatable by implementing <em>animatableData</em> property. But how we can animate multiple properties of the same shape? There is another type called <em>AnimatablePair</em> that helps us to animate the paired values. Let’s make our <em>Line</em> struct animatable in both vertical and horizontal directions.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">Line2</span><span class="p">:</span> <span class="kt">Shape</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">CGFloat</span>
    <span class="k">var</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">CGFloat</span>

    <span class="k">var</span> <span class="nv">animatableData</span><span class="p">:</span> <span class="kt">AnimatablePair</span><span class="o">&lt;</span><span class="kt">CGFloat</span><span class="p">,</span> <span class="kt">CGFloat</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="kt">AnimatablePair</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">newValue</span><span class="o">.</span><span class="n">first</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">newValue</span><span class="o">.</span><span class="n">second</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">path</span><span class="p">(</span><span class="k">in</span> <span class="nv">rect</span><span class="p">:</span> <span class="kt">CGRect</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Path</span> <span class="p">{</span>
        <span class="kt">Path</span> <span class="p">{</span> <span class="n">path</span> <span class="k">in</span>
            <span class="n">path</span><span class="o">.</span><span class="nf">move</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="o">.</span><span class="n">zero</span><span class="p">)</span>
            <span class="n">path</span><span class="o">.</span><span class="nf">addLine</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">y</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>OK, nice. Now we can animate two values of the same shape. But what about the line chart? Assume that you are working on the charting library, and you want to build an animatable line chart? There might be hundreds of values that we want to animate. How could we deal with this challenge?</p>

<h4 id="introducing-vectorarithmetic-protocol">Introducing VectorArithmetic protocol</h4>
<p>As you can see, we have already used <em>CGFloat</em> and <em>AnimatablePair</em> types as animatable data. But it doesn’t mean that you can use any type here. <em>Animatable</em> protocol has a constraint on <em>animatableData</em> property. Any type that conforms to <em>VectorArithmetic</em> protocol can be used as <em>animtableData</em>. SwiftUI provides us a few types that conform to <em>VectorArithmetic</em> protocol out of the box. For example, <em>Float</em>, <em>Double</em>, <em>CGFloat</em>, and <em>AnimatablePair</em>.</p>

<p>Let’s back to our line chart idea. I want to make a line chart shape that animates all the values. There are probably could be hundreds of points, and it looks like an excellent candidate for a custom type that conforms to <em>VectorArithmetic</em> protocol. <em>VectorArithmetic</em> has a few requirements like scaling, adding, subtracting, etc. You should describe how SwiftUI must handle these operations on your type. Here is a drop-in implementation for an array of values.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>
<span class="kd">import</span> <span class="kd">enum</span> <span class="kt">Accelerate</span><span class="o">.</span><span class="n">vDSP</span>

<span class="kd">struct</span> <span class="kt">AnimatableVector</span><span class="p">:</span> <span class="kt">VectorArithmetic</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">zero</span> <span class="o">=</span> <span class="kt">AnimatableVector</span><span class="p">(</span><span class="nv">values</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">])</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="o">+</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">AnimatableVector</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">AnimatableVector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnimatableVector</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="k">return</span> <span class="kt">AnimatableVector</span><span class="p">(</span><span class="nv">values</span><span class="p">:</span> <span class="n">vDSP</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">count</span><span class="p">],</span> <span class="n">rhs</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">count</span><span class="p">]))</span>
    <span class="p">}</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">AnimatableVector</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">AnimatableVector</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="n">vDSP</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">count</span><span class="p">],</span> <span class="n">rhs</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">count</span><span class="p">],</span> <span class="nv">result</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">count</span><span class="p">])</span>
    <span class="p">}</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="o">-</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">AnimatableVector</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">AnimatableVector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnimatableVector</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="k">return</span> <span class="kt">AnimatableVector</span><span class="p">(</span><span class="nv">values</span><span class="p">:</span> <span class="n">vDSP</span><span class="o">.</span><span class="nf">subtract</span><span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">count</span><span class="p">],</span> <span class="n">rhs</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">count</span><span class="p">]))</span>
    <span class="p">}</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="o">-=</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">AnimatableVector</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">AnimatableVector</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="n">vDSP</span><span class="o">.</span><span class="nf">subtract</span><span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">count</span><span class="p">],</span> <span class="n">rhs</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">count</span><span class="p">],</span> <span class="nv">result</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">count</span><span class="p">])</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">values</span><span class="p">:</span> <span class="p">[</span><span class="kt">Double</span><span class="p">]</span>

    <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">scale</span><span class="p">(</span><span class="n">by</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">Double</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">vDSP</span><span class="o">.</span><span class="nf">multiply</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">magnitudeSquared</span><span class="p">:</span> <span class="kt">Double</span> <span class="p">{</span>
        <span class="n">vDSP</span><span class="o">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">vDSP</span><span class="o">.</span><span class="nf">multiply</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see, I use the <em>Accelerate</em> framework that provides us high-performance vector-based arithmetic. By using <em>AnimatableVector</em> struct, we can animate as many values as we want, and it will work super fast because it uses the <em>Accelerate</em> framework. Now we have all we need to implement an animatable line chart shape.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>

<span class="kd">struct</span> <span class="kt">LineChart</span><span class="p">:</span> <span class="kt">Shape</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">vector</span><span class="p">:</span> <span class="kt">AnimatableVector</span>

    <span class="k">var</span> <span class="nv">animatableData</span><span class="p">:</span> <span class="kt">AnimatableVector</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="n">vector</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="n">vector</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">path</span><span class="p">(</span><span class="k">in</span> <span class="nv">rect</span><span class="p">:</span> <span class="kt">CGRect</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Path</span> <span class="p">{</span>
        <span class="kt">Path</span> <span class="p">{</span> <span class="n">path</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">xStep</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="kt">CGFloat</span><span class="p">(</span><span class="n">vector</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
            <span class="k">var</span> <span class="nv">currentX</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="n">xStep</span>
            <span class="n">path</span><span class="o">.</span><span class="nf">move</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="o">.</span><span class="n">zero</span><span class="p">)</span>

            <span class="n">vector</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                <span class="n">path</span><span class="o">.</span><span class="nf">addLine</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">currentX</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">CGFloat</span><span class="p">(</span><span class="nv">$0</span><span class="p">)))</span>
                <span class="n">currentX</span> <span class="o">+=</span> <span class="n">xStep</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>You can download the source code of <em>AnimatableVector</em> through <a href="https://gist.github.com/mecid/18a80b18cc9670eef1d8667cf8c886bd">Github gist</a>.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">RootView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">vector</span><span class="p">:</span> <span class="kt">AnimatableVector</span> <span class="o">=</span> <span class="o">.</span><span class="n">zero</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">LineChart</span><span class="p">(</span><span class="nv">vector</span><span class="p">:</span> <span class="n">vector</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">stroke</span><span class="p">(</span><span class="kt">Color</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">animation</span><span class="p">(</span><span class="kt">Animation</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">repeatForever</span><span class="p">())</span>
            <span class="o">.</span><span class="n">onAppear</span> <span class="p">{</span> 
                <span class="k">self</span><span class="o">.</span><span class="n">vector</span> <span class="o">=</span> <span class="kt">AnimatableVector</span><span class="p">(</span><span class="nv">values</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span> 
            <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p><img src="/public/linechart.gif" alt="linechart-animation" /></p>

<h4 id="conclusion">Conclusion</h4>
<p>I hope you enjoy the post. Feel free to follow me on <a href="https://twitter.com/mecid">Twitter</a> and ask your questions related to this post. Thanks for reading, and see you next week!</p>

</article>


<aside class="related">
  <h4>Recent posts</h4>
  <ul class="related-posts">
    
      <li>
        <a title="Custom accessibility content in SwiftUI" href="/2021/10/06/custom-accessibility-content-in-swiftui/">
          Custom accessibility content in SwiftUI
          <small><time datetime="2021-10-06T00:00:00+08:00">06 Oct 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Audio graphs in SwiftUI" href="/2021/09/29/audio-graphs-in-swiftui/">
          Audio graphs in SwiftUI
          <small><time datetime="2021-09-29T00:00:00+08:00">29 Sep 2021</time></small>
        </a>
      </li>
    
      <li>
        <a title="Accessibility focus in SwiftUI" href="/2021/09/23/accessibility-focus-in-swiftui/">
          Accessibility focus in SwiftUI
          <small><time datetime="2021-09-23T00:00:00+08:00">23 Sep 2021</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
          <img class="avatar" alt="mecid" width="100" height="100" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/mecid?v=3&s=100" srcset="https://avatars2.githubusercontent.com/mecid?v=3&s=100 1x, https://avatars2.githubusercontent.com/mecid?v=3&s=200 2x, https://avatars2.githubusercontent.com/mecid?v=3&s=300 3x, https://avatars2.githubusercontent.com/mecid?v=3&s=400 4x" />
          <small>Hi there! I am code4you,I like to program, and do some App.</small>
          <small>I'm a developer</small>
          <small>Feel free to follow me on <a href="https://github.com/code4you2021">Github</a>.</small>
        <small>
          &copy; <time datetime="2021-10-17T11:25:11+08:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WQVZK1CR7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-18491817-18');
    </script>
    
  </body>
</html>
